<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecblog/component---src-components-post-js.345c7c4f16662f410581.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.345c7c4f16662f410581.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecblog/component---src-components-post-js-dbedf083f25f7ad1f3b1.js"/><link as="script" rel="preload" href="/swizecblog/0-f215691c134019ee6fa5.js"/><link as="script" rel="preload" href="/swizecblog/app-49ff0b4ea28eff25fc3b.js"/><link as="script" rel="preload" href="/swizecblog/webpack-runtime-b34af8fd410bb07c9828.js"/><link rel="preload" href="/swizecblog/static/d/791/path---post-blackbox-testing-node-js-apps-12-a-87c-xo16EMI7VcWze0iqCo2JwZfk7I.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecblog/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Thoughts/">Thoughts</a></ul></div><h1>Blackbox testing node.js apps</h1><div><p>One of the best features in <a class="zem_slink" title="Django (Web framework)" href="http://www.djangoproject.com" rel="homepage" target="_blank">Django</a>is the test client that comes with the test framework -&gt; blackbox testing baby, yeah!</p>
<div style="width: 250px" class="wp-caption alignright"><a href="http://www.flickr.com/photos/23739231@N00/1972546648" target="_blank"><img class="zemanta-img-inserted zemanta-img-configured" title="Black box flight recorder" src="http://farm3.static.flickr.com/2215/1972546648_e63db0846e_m.jpg" alt="Black box flight recorder" width="240" height="180" /></a><p class="wp-caption-text">Black box flight recorder (Photo credit: edvvc)</p></div>
<p><a class="zem_slink" title="Black-box testing" href="http://en.wikipedia.org/wiki/Black-box_testing" rel="wikipedia" target="_blank">Blackbox testing</a> is my favourite kind of testing. Much more useful than <a class="zem_slink" title="Unit testing" href="http://en.wikipedia.org/wiki/Unit_testing" rel="wikipedia" target="_blank">unit tests</a> and generally a lot easier to write, maintain and deal with. And that&#8217;s because rather than making sure all your functions and deep internals are behaving like they should, you only test what really matters in a web app.</p>
<p><em>Does the right output happen for this specific input?</em></p>
<p>Your users don&#8217;t care that you have full unit test coverage. They will never see the output of all your internal functions and methods and database drivers and whatnot. All they care is that if they put in <em>X</em> they get the correct <em>Y</em> out.</p>
<p>The two main benefits of blackbox testing for a developer are:</p>
<ol>
<li>Low maintenance tests &#8211; you don&#8217;t have to rewrite the whole <a class="zem_slink" title="Test suite" href="http://en.wikipedia.org/wiki/Test_suite" rel="wikipedia" target="_blank">test suite</a> when refactoring the deep internals of your app</li>
<li>Integration tests &#8211; since you&#8217;re only matching input to output you are testing your whole chain, everything from routing, to database connections and the business logic of the app itself</li>
</ol>
<p>Although it&#8217;s still prudent to write enough of these tests to check for correctly returning errors, making sure your app doesn&#8217;t crash on strange inputs and so on.</p>
<p>It&#8217;s also important not to forget unit tests for core business logic. That&#8217;s algorithmic stuff, algorithms should have unit tests attached to them. But in general, web apps aren&#8217;t algorithms, they&#8217;re systems. And systems need blackbox tests.</p>
<h2>Doing it in node.js</h2>
<p>Ok so blackbox testing is an awesome fit for web apps. But how do you do them?</p>
<p>In django this is simple, when in a test you just say something like</p>
<pre lang="python">response = self.client.get("/my/url")
self.assertEqual(response.status, 200)</pre>
<p>and check the response is what you expected. The test client automagically ensures there is a fake server running, that it takes requests, responds and is then torn down when you&#8217;re done testing.</p>
<p>Until recently the only way I knew of doing this with node.js has been to run the server and send it requests. But that&#8217;s a bit lame, after all, I want to just run the tests. Of course I&#8217;m going to forget to run the server every single time.</p>
<p>Not to mention you have to keep restarting it when you change the code.</p>
<p>Enter <a href="https://github.com/visionmedia/supertest" target="_blank">Supertest</a>, stage left.</p>
<p>Supertest is a high-level http test library based on superagent, which in turn is a high-level abstraction thingy for doing http requests.</p>
<p>It takes any type of server object and lets you run requests and check for expected results in a very simple manner. If need be, you can even drop down to the low-level API&#8217;s for http requests.</p>
<p>A simple (mocha) test might look something like this:</p>
<pre lang="javascript">var app = require('../app.js');

describe('GET /users', function(){
  it('respond with json', function(done){
    request(app)
      .get('/user')
      .set('Accept', 'application/json')
      .expect('Content-Type', /json/)
      .expect(200, done);
  })
})</pre>
<p>Where <em>app</em> is, for example, an express.js server &#8211;  <em>request</em> is our test client. We are just checking that sending a <a class="zem_slink" title="Hypertext Transfer Protocol" href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol" rel="wikipedia" target="_blank">GET request</a> to <em>/user</em> will return some sort of json and that the status code will be 200.</p>
<p>If the server isn&#8217;t running when doing that <em>require</em> then supertest will make sure it is bound to an ephemereal port and then brought back down after the tests are done.</p>
<p>Oh and because of <a href="https://github.com/visionmedia/superagent" target="_blank">superagent</a> you can send any type of request and check for any type of response.</p>
<p>Awesome.</p>
<h6 class="zemanta-related-title" style="font-size: 1em;">Related articles</h6>
<ul class="zemanta-article-ul zemanta-article-ul-image" style="margin-left: 0; display: inline-block; list-style-type: none;">
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://stackoverflow.com/questions/10960502/foreman-nodejs-mongoskin-how-to-connect-to-mongodb-from-mongo-cli" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/93336637_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://stackoverflow.com/questions/10960502/foreman-nodejs-mongoskin-how-to-connect-to-mongodb-from-mongo-cli" target="_blank">Foreman + NodeJS + MongoSkin: How to connect to mongodb from mongo cli?</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://stackoverflow.com/questions/11546715/node-js-api-choking-with-concurrent-connections" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/101387271_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://stackoverflow.com/questions/11546715/node-js-api-choking-with-concurrent-connections" target="_blank">Node.js API choking with concurrent connections</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://www.joezimjs.com/javascript/node-js-for-true-beginners/" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/101502577_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://www.joezimjs.com/javascript/node-js-for-true-beginners/" target="_blank">Node.js for True Beginners</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://architects.dzone.com/articles/when-net-dev-decides-its-time" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/noimg_06_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://architects.dzone.com/articles/when-net-dev-decides-its-time" target="_blank">When a .NET Dev Decides It&#8217;s Time for Node.js</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://stackoverflow.com/questions/2353818/how-do-i-get-started-with-node-js/9629682" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/89920188_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://stackoverflow.com/questions/2353818/how-do-i-get-started-with-node-js/9629682" target="_blank">Answer by Nevir for How do I get started with Node.js</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
</ul>
<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;"><a class="zemanta-pixie-a" title="Enhanced by Zemanta" href="http://www.zemanta.com/?px"><img class="zemanta-pixie-img" style="border: none; float: right;" src="http://img.zemanta.com/zemified_e.png?x-id=bdac80da-9a78-4071-ac4b-f2d10e0a4b65" alt="Enhanced by Zemanta" /></a></div>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-blackbox-testing-node-js-apps-12a","path":"/post/blackbox-testing-node-js-apps/"};window.dataPath="791/path---post-blackbox-testing-node-js-apps-12-a-87c-xo16EMI7VcWze0iqCo2JwZfk7I";/*]]>*/</script><script src="/swizecblog/webpack-runtime-b34af8fd410bb07c9828.js" async=""></script><script src="/swizecblog/app-49ff0b4ea28eff25fc3b.js" async=""></script><script src="/swizecblog/0-f215691c134019ee6fa5.js" async=""></script><script src="/swizecblog/component---src-components-post-js-dbedf083f25f7ad1f3b1.js" async=""></script></body></html>