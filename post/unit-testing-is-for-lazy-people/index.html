<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecblog/component---src-components-post-js.345c7c4f16662f410581.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.345c7c4f16662f410581.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecblog/component---src-components-post-js-dbedf083f25f7ad1f3b1.js"/><link as="script" rel="preload" href="/swizecblog/0-f215691c134019ee6fa5.js"/><link as="script" rel="preload" href="/swizecblog/app-49ff0b4ea28eff25fc3b.js"/><link as="script" rel="preload" href="/swizecblog/webpack-runtime-b34af8fd410bb07c9828.js"/><link rel="preload" href="/swizecblog/static/d/604/path---post-unit-testing-is-for-lazy-people-923-d54-YMY4k3o5W4vfcM8HehVxS1zcJs.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecblog/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Thoughts/">Thoughts</a></ul></div><h1>Unit testing is for lazy people</h1><div><p>The other day I was talking to a guy about a possible freelancing gig and he said how wonderful it was that I should bring up the topic of unit/<a class="zem_slink" title="Test automation" href="http://en.wikipedia.org/wiki/Test_automation" rel="wikipedia">automated testing</a>without being asked. Said that most (many?) developers don&#8217;t have the level of rigor to use automated testing.</p>
<div id="attachment_3790" style="width: 373px" class="wp-caption alignright"><a href="http://swizec.com/blog/wp-content/uploads/2012/02/fallen-building.jpg"><img class=" wp-image-3790 " title="Oops building" src="http://swizec.com/blog/wp-content/uploads/2012/02/fallen-building.jpg" alt="Oops building" width="363" height="246" srcset="https://swizec.com/blog/wp-content/uploads/2012/02/fallen-building.jpg 519w, https://swizec.com/blog/wp-content/uploads/2012/02/fallen-building-300x202.jpg 300w" sizes="(max-width: 363px) 100vw, 363px" /></a><p class="wp-caption-text">Oops building</p></div>
<p>My reaction was one of disbelief <em>&#8220;Rigor!? But automated testing is one of the laziest things a developer can do! It speeds stuff up </em>so<em> much!&#8221;</em></p>
<p>As luck would have it, last night I was hit over the head with my own words and nearly died <a class="zem_slink" title="Debugging" href="http://en.wikipedia.org/wiki/Debugging" rel="wikipedia">debugging</a> a single function.</p>
<p>I was working on Stripe webhooks and for security reasons decided not to use the event data sent in request body. Makes sense right? Take the event id from request body, then fetch the actual event from Stripe.</p>
<p>It&#8217;s the only way to be certain you aren&#8217;t responding to bogus events sent by an evil person trying to make you look bad (nothing <em>actually</em> bad can happen, at worst a customer would get extra paid invoice emails).</p>
<p>Due to poor decoupling &#8211; I didn&#8217;t really want to decouple a 6 line function into two functions &#8211; everything was now difficult to test. I can&#8217;t create events on Stripe&#8217;s servers with <a class="zem_slink" title="Unit testing" href="http://en.wikipedia.org/wiki/Unit_testing" rel="wikipedia">unit tests</a> and without actual events existing I can&#8217;t test the function works as it&#8217;s supposed to.</p>
<p>How many bugs can you put in a 6 line function anyway?</p>
<h2>A lot of bugs!</h2>
<p>When the client tested on staging &#8230; it didn&#8217;t work. Invoice email wasn&#8217;t sent and Stripe complained of a <a class="zem_slink" title="List of HTTP status codes" href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes" rel="wikipedia">500 error</a>.</p>
<div style="width: 310px" class="wp-caption alignright"><a href="http://commons.wikipedia.org/wiki/File:Army_Camp-sml.JPG"><img class="zemanta-img-inserted zemanta-img-configured" title="English: British Army Signals Trials Unit test..." src="http://swizec.com/blog/wp-content/uploads/2012/02/300px-Army_Camp-sml.jpg" alt="English: British Army Signals Trials Unit test..." width="300" height="221" /></a><p class="wp-caption-text">Image via Wikipedia</p></div>
<p>It took me almost two hours to fix all the bugs because my testing cycle looked like this:</p>
<ol>
<li>change code</li>
<li>commit to <em>develop branch</em></li>
<li>switch to <em>staging branch</em></li>
<li>merge develop branch into staging</li>
<li>push to github</li>
<li>change to other terminal window</li>
<li>pull from staging branch</li>
<li>restart python processes</li>
<li>go to Stripe dashboard</li>
<li>pick customer</li>
<li>create invoice item</li>
<li>create actual invoice</li>
<li>choose invoice</li>
<li><em>pay</em> invoice</li>
<li>go to Stripe logs</li>
<li>find <em>invoice.payment_succeeded</em> webhook</li>
<li>scroll down to response</li>
<li>look through raw html of django&#8217;s error page</li>
<li>find symptom</li>
<li>GOTO 1.</li>
</ol>
<p>That&#8217;s right, a whopping <em>20 step</em> debug cycle all because I&#8217;m an idiot and couldn&#8217;t find a way to automate this. Or maybe I was too tired to do the unobvious thing &#8230; although I still don&#8217;t want to split a 6 liner into two functions.</p>
<p>With proper <a class="zem_slink" title="Unit testing" href="http://en.wikipedia.org/wiki/Unit_testing" rel="wikipedia">unit testing</a> the debug cycle would look like this:</p>
<ol>
<li>change code</li>
<li>run tests</li>
<li>symptom thrown in face</li>
<li>GOTO 1.</li>
</ol>
<p>Much lazier right?</p>
<p>For the record, those six lines of code contained <strong>4</strong> bugs -&gt;</p>
<ul>
<li>forgot to import a module</li>
<li>different event data structure than I understood from the docs</li>
<li>twice^</li>
<li>misnamed variables from one line to another</li>
</ul>
<p>Yes, all of those could <em>easily</em> have been caught if my <a class="zem_slink" title="Fault coverage" href="http://en.wikipedia.org/wiki/Fault_coverage" rel="wikipedia">test coverage</a> was actually any good! And then not only would I not look like an idiot in front of the client, I&#8217;d probably spend no more than ten minutes fixing this.</p>
<p>Let this be a lesson both to you and to Future Swizec!</p>
<h6 class="zemanta-related-title" style="font-size: 1em;">Related articles</h6>
<ul class="zemanta-article-ul">
<li class="zemanta-article-ul-li"><a href="http://stackoverflow.com/questions/9418892/easymock-times-behaviour-not-being-checked-for-strict-mock">EasyMock: Times behaviour not being checked for strict mock</a> (stackoverflow.com)</li>
<li class="zemanta-article-ul-li"><a href="http://stackoverflow.com/questions/8719147/how-do-continuous-integration-and-automated-tests-look-in-practice">How does continuous integration and automated tests look in practice?</a> (stackoverflow.com)</li>
<li class="zemanta-article-ul-li"><a href="http://autismjungle.wordpress.com/2012/02/26/change-of-plan/">Change of Plan</a> (autismjungle.wordpress.com)</li>
<li class="zemanta-article-ul-li"><a href="http://www.makinggoodsoftware.com/2012/01/27/the-evil-unit-test/">The evil unit test.</a> (makinggoodsoftware.com)</li>
<li class="zemanta-article-ul-li"><a href="http://kimphanvn.wordpress.com/2012/02/27/test-driven-development-best-practices-and-benefits-of-using-unit-testing-on-real-life-projects/">Test Driven Development: Best Practices and Benefits of Using Unit Testing on Real Life Projects</a> (kimphanvn.wordpress.com)</li>
<li class="zemanta-article-ul-li"><a href="http://mallibone.wordpress.com/2012/02/14/run-your-tests-with-a-single-command/">Run your all your tests with rake</a> (mallibone.wordpress.com)</li>
<li class="zemanta-article-ul-li"><a href="http://www.slideshare.net/gilzilberfeld/introduction-to-unit-testing-10983708">Introduction to unit testing</a> (slideshare.net)</li>
</ul>
<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;"><a class="zemanta-pixie-a" title="Enhanced by Zemanta" href="http://www.zemanta.com/"><img class="zemanta-pixie-img" style="border: none; float: right;" src="http://img.zemanta.com/zemified_e.png?x-id=140931a7-b24e-4c17-95ae-a9e183cc803b" alt="Enhanced by Zemanta" /></a></div>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-unit-testing-is-for-lazy-people-923","path":"/post/unit-testing-is-for-lazy-people/"};window.dataPath="604/path---post-unit-testing-is-for-lazy-people-923-d54-YMY4k3o5W4vfcM8HehVxS1zcJs";/*]]>*/</script><script src="/swizecblog/webpack-runtime-b34af8fd410bb07c9828.js" async=""></script><script src="/swizecblog/app-49ff0b4ea28eff25fc3b.js" async=""></script><script src="/swizecblog/0-f215691c134019ee6fa5.js" async=""></script><script src="/swizecblog/component---src-components-post-js-dbedf083f25f7ad1f3b1.js" async=""></script></body></html>