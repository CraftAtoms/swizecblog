<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecwp/component---src-components-post-js.a8953a73f94ec29b14b1.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.a8953a73f94ec29b14b1.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecwp/component---src-components-post-js-f2c2d6ca006cef019723.js"/><link as="script" rel="preload" href="/swizecwp/0-ce760dfe358fb4e73f84.js"/><link as="script" rel="preload" href="/swizecwp/app-affbd460d24d53f1fc4a.js"/><link as="script" rel="preload" href="/swizecwp/webpack-runtime-7742d5ce65cd19570880.js"/><link rel="preload" href="/swizecwp/static/d/338/path---post-making-our-irc-bot-talk-750-1e1-SYiA6zkb3sK6ClPP35PNO6scOZU.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecwp/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecwp/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecwp/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecwp/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecwp/Thoughts/">Thoughts</a></ul></div><h1>Making our irc bot talk</h1><div><blockquote><p>[18:21:38] &lt;HairyFotr&gt; _chatty-botko_ we desire to hear moar of you&#8217;re infinite wisdom<br />
[18:21:38] &lt;_chatty-botko_&gt; know it broken ? _chatty-botko_ doesn&#8217;t though gets</p></blockquote>
<p><a class="zem_slink" title="Internet Relay Chat" href="http://en.wikipedia.org/wiki/Internet_Relay_Chat" rel="wikipedia" target="_blank">IRC</a> might seem quaint and outdated, but for keeping in touch with a group of friends it beats <a class="zem_slink" title="Twitter" href="http://twitter.com" rel="homepage" target="_blank">Twitter</a>, Facebook and Google+ hands down.</p>
<div style="width: 370px" class="wp-caption alignright"><img class=" " title="Robot" src="http://www.theuniversesolved.com/images/irobot1.jpg" alt="Robot" width="360" height="281" /><p class="wp-caption-text">Robot</p></div>
<p>There&#8217;s a bunch of <em>others</em>Â on those things. With IRC there&#8217;s just us &#8230; and a robot overlord.</p>
<p>Mostly <em>_botko_</em>Â makes sure to mention when we repost links and keeps irc logs for us. But as soon as <a href="https://twitter.com/#!/smotko" target="_blank">@smotko</a> added random phrases to make keeping us in place more interesting. We wanted more.</p>
<p>We wanted our bot to speak.</p>
<p>It&#8217;s been ages since I coded just for fun, so last night I made <em>_botko_</em>Â talk.</p>
<h2>What to say?</h2>
<blockquote><p>[18:03:13] &lt;_chatty-botko_&gt; _botko_ probably feels left out<br />
[18:12:45] &lt;_chatty-botko_&gt; auto complete ðŸ˜€ whoa! mind = blown</p></blockquote>
<p>So how do you make a robot speak?</p>
<p>Natural language generation is a <em>huge</em>Â field, hell I&#8217;m doing <a href="http://swizec.github.com/Le-Thesis/" target="_blank">my thesis</a> in that general vicinity. For this project I just wanted to have a little fun, not invent a monster -&gt; <a class="zem_slink" title="Markov chain" href="http://en.wikipedia.org/wiki/Markov_chain" rel="wikipedia" target="_blank">markov chain</a> <a class="zem_slink" title="Natural language generation" href="http://en.wikipedia.org/wiki/Natural_language_generation" rel="wikipedia" target="_blank">text generation</a>!</p>
<p>The way a markov chain text generator works is basically:</p>
<ol>
<li>split a text into words</li>
<li>create n-grams (n-length groups of words, I used n=1)</li>
<li>create unique hashes of all n-grams</li>
<li>map each <a class="zem_slink" title="N-gram" href="http://en.wikipedia.org/wiki/N-gram" rel="wikipedia" target="_blank">n-gram</a> to a list of <em>next</em>Â n-grams</li>
</ol>
<p>You end up with this sort of data structure.</p>
<pre lang="python">{-8818677644356330256: {'next': {-6361492750444014453: 1},
                        'text': ['dobu'],
                        'weight': 1.9},
 -8629397782117610386: {'next': {}, 'text': ['podatkov'], 'weight': 0.9},
 7424044602067048: {'next': {14336086128129331: 0.9, 1480645349370722979: 1},
                    'text': [':D'],
                    'weight': 2.9},
# and so on for quite a while</pre>
<p>While this works great for static text, an irc chatroom is a rolling <a class="zem_slink" title="Time series" href="http://en.wikipedia.org/wiki/Time_series" rel="wikipedia" target="_blank">time series</a> that never really ends. Not only will you soon run out of memory, how do you deal with staying relevant?</p>
<p>I had to wait until <em><strong>4:03AM</strong></em>Â for the solution to hit me!</p>
<p>It doesn&#8217;t have to be complicated at all &#8211; just decay the weights of all <em>next</em>Â items whenever you poke an element. And do the same whenever a new text is added to the Corpus.</p>
<p>Especially important is to choose the starting point well. The more relevant it is to current discussion, the more chance you have of saying something relevant. So instead of choosing at random, we make a weighted choice here as well.</p>
<p>When everything is packaged together, usage becomes pretty simple:</p>
<pre lang="python">corpus.add(text) # repeat this a couple of times

# to generate, you just
corpus.rewind()
text = " ".join(take(corpus, 5)) # creates a 5 word text</pre>
<p>All the <a href="https://github.com/Swizec/botko/blob/speaking/src/Corpus.py" target="_blank">code is on github</a>.</p>
<p>Making the data structure iterable like that was especially interesting. Now I can change how the generator works without affecting external code.</p>
<pre lang="python">    def __iter__(self):
        return self

    def __setitem__(self, ngram, value):
        key = self.__hash(ngram)
        self.data[key] = value

    # adapted from
    # http://eli.thegreenplace.net/2010/01/22/weighted-random-generation-in-python/
    def __weighted_choice(self, items):
        rnd = random.random() * sum([w for w, k in items])
        for i, item in enumerate(items):
            rnd -= item[0]
            if rnd &lt; 0:
                return item[1]

    def __next(self, ngram):
        item = self.__getitem__(ngram)

        if len(item['next']) == 0:
            raise StopIteration

        return self.data[self.__weighted_choice(zip(item['next'].values(),
                                                    item['next'].keys()))
                         ]['text']

    def next(self):
        if not hasattr(self, 'current_ngram'):
            self.rewind()

        self.current_ngram = self.__next(self.current_ngram)
        return self.current_ngram</pre>
<p>Pretty cool right?</p>
<h2>When to speak?</h2>
<p>Okay, that takes care of generating the text. But when shouldÂ <em>_botko_</em>Â speak anyway?</p>
<div style="width: 250px" class="wp-caption alignright"><a href="http://www.flickr.com/photos/49503157467@N01/2866792711" target="_blank"><img class="zemanta-img-inserted zemanta-img-configured" title="How Should You Act on IRC (Internet Relay Chat..." src="http://farm4.static.flickr.com/3246/2866792711_027e60dd7e_m.jpg" alt="How Should You Act on IRC (Internet Relay Chat..." width="240" height="180" /></a><p class="wp-caption-text">How Should You Act on IRC (Internet Relay Chatroom)? (Photo credit: Chris Pirillo)</p></div>
<p>You certainly don&#8217;t want the bot to spam everyone. But you don&#8217;t want him to be completely quiet most of the time.Â Speaking every X amount of events is simply too predictable and boring &#8230;</p>
<p>Ideally you&#8217;d want him to speak more when the chatroom is busier and less when it&#8217;s a bit quiet. When it&#8217;s been quiet for a long time and it suddenly becomes very busy, that&#8217;s also a good time to speak.</p>
<p>Sort of like a greeting.</p>
<p>I ended up using a combination of chat velocity and the rate of chat acceleration change to determine the probability of speaking, which is then still left up to <a class="zem_slink" title="Randomness" href="http://en.wikipedia.org/wiki/Randomness" rel="wikipedia" target="_blank">randomness</a>.</p>
<p>Velocity is measured as the ratio between the timespan of the last 10 messages and the timespan of the last 60. This basically measures how densely the messages are coming into the chatroom right now.</p>
<pre lang="python">velocity_rate = (now - 10_messages_ago_time)/(now - 60_messages_ago_time)</pre>
<p>The rate of acceleration change idea took some time to materialize in my head.Â The idea is that you want to make it likelier for the bot to speak when there is a sudden flurry of activity and fall back to the <em>velocity_rate</em> formula when conditions are mostly stable.</p>
<pre lang="python">v_i = average_speed_of_last_[0+i : i*5]_messages
a_i = delta_of_two_speeds
accel_rate = a_1/a_2</pre>
<p>It looks simple in pseudocode, but I promise it took a fair amount of head banging to come up with that!</p>
<p>This part of the <a href="https://github.com/Swizec/botko/blob/speaking/src/chitchat.py" target="_blank">code is also on github</a>.</p>
<h2>Lovely!</h2>
<p>That&#8217;s pretty much it. Our IRC room now has a bot that entertains everyone with its nonsense and I couldn&#8217;t make myself go to bed until almost five in the morning.</p>
<p>All that&#8217;s left to do now is tweaking the parameters a bit, perhaps iron out a bug or two.</p>
<p>I&#8217;m almost tempted to connect this guy to #startups &#8230;</p>
<blockquote><p>[18:27:27] wisdom ACTION uses this quote in blogpost because it&#8217;s starting<br />
[18:27:43] I almost have to use that &#8230;<br />
[18:27:44] kul, to da si se spet zacel ful pogovarjat, prej</p></blockquote>
<h6 class="zemanta-related-title" style="font-size: 1em;">Related articles</h6>
<ul class="zemanta-article-ul">
<li class="zemanta-article-ul-li"><a href="http://bostinno.com/2012/03/06/boston-dynamics-cheetah-breaks-land-speed-record-for-legged-bots-might-have-insatiable-blood-thirst-video/" target="_blank">Boston Dynamics&#8217; Cheetah Breaks Land Speed Record for Legged Bots, Might Have Insatiable Blood Thirst [Video]</a> (bostinno.com)</li>
<li class="zemanta-article-ul-li"><a href="http://go.theregister.com/feed/www.theregister.co.uk/2012/04/25/turing_test_prize_bletchley_park/" target="_blank">Wannabe-human bots face 2012 Turing Test in Turing&#8217;s old office</a> (go.theregister.com)</li>
<li class="zemanta-article-ul-li"><a href="http://www.gamespot.com/dawnspire-prelude/reviews/dawnspire-prelude-review-6168979/" target="_blank">Dawnspire: Prelude</a> (gamespot.com)</li>
<li class="zemanta-article-ul-li"><a href="http://www.i-programmer.info/bookreviews/65-mathematics/3696-hidden-markov-models-for-time-series.html" target="_blank">Hidden Markov Models for Time Series</a> (i-programmer.info)</li>
<li class="zemanta-article-ul-li"><a href="http://gumption.typepad.com/blog/2011/06/socialbots-2-artificial-intelligence-social-intelligence-and-twitter.html" target="_blank">Socialbots 2: Artificial Intelligence, Social Intelligence and Twitter</a> (gumption.typepad.com)</li>
<li class="zemanta-article-ul-li"><a href="http://news.cnet.com/8301-27080_3-10452342-245.html?part=rss&amp;subj=news&amp;tag=2547-1_3-0-20" target="_blank">Beware strangers on IM who won&#8217;t answer your questions</a> (news.cnet.com)</li>
<li class="zemanta-article-ul-li"><a href="http://www.readwriteweb.com/archives/when_bots_go_mad.php" target="_blank">When Bots Go Mad</a> (readwriteweb.com)</li>
<li class="zemanta-article-ul-li"><a href="http://afetteredmind.com/2012/04/25/ray-kurzweil-and-the-singularity/" target="_blank">Ray Kurzweil&#8230;and the singularity</a> (afetteredmind.com)</li>
<li class="zemanta-article-ul-li"><a href="http://hackaday.com/2012/04/25/a-camera-that-describes-a-picture-for-you/" target="_blank">A camera that describes a picture for you</a> (hackaday.com)</li>
</ul>
<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;"><a class="zemanta-pixie-a" title="Enhanced by Zemanta" href="http://www.zemanta.com/"><img class="zemanta-pixie-img" style="border: none; float: right;" src="http://img.zemanta.com/zemified_e.png?x-id=dcc40786-643b-40dc-8f49-6c869a6c7a72" alt="Enhanced by Zemanta" /></a></div>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-making-our-irc-bot-talk-750","path":"/post/making-our-irc-bot-talk/"};window.dataPath="338/path---post-making-our-irc-bot-talk-750-1e1-SYiA6zkb3sK6ClPP35PNO6scOZU";/*]]>*/</script><script src="/swizecwp/webpack-runtime-7742d5ce65cd19570880.js" async=""></script><script src="/swizecwp/app-affbd460d24d53f1fc4a.js" async=""></script><script src="/swizecwp/0-ce760dfe358fb4e73f84.js" async=""></script><script src="/swizecwp/component---src-components-post-js-f2c2d6ca006cef019723.js" async=""></script></body></html>