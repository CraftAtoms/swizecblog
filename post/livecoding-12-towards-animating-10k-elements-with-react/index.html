<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecblog/component---src-components-post-js.345c7c4f16662f410581.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.345c7c4f16662f410581.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecblog/component---src-components-post-js-dbedf083f25f7ad1f3b1.js"/><link as="script" rel="preload" href="/swizecblog/0-f215691c134019ee6fa5.js"/><link as="script" rel="preload" href="/swizecblog/app-49ff0b4ea28eff25fc3b.js"/><link as="script" rel="preload" href="/swizecblog/webpack-runtime-b34af8fd410bb07c9828.js"/><link rel="preload" href="/swizecblog/static/d/62/path---post-livecoding-12-towards-animating-10-k-elements-with-react-743-383-8DXKsflThuBp1gSsSS4ITirsw.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecblog/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Thoughts/">Thoughts</a></ul></div><h1>Livecoding #12: towards animating 10k+ elements with React</h1><div><p><em>This is a Livecoding Recap &#8211; an almost-weekly post about interesting things discovered while livecoding. It is shorter than 500 words. There are pictures. You can follow my channel, <a href="https://www.livecoding.tv/swizec/">here</a>. New stuff shows up almost <strong>every Sunday at 2pm PDT</strong>. There‚Äôs live chat üòâ</em></p>
<p>Welcome to the first Livecoding Recap. This recap is for the 12th live coding. I don‚Äôt have an excuse for not recapping before now. It just took me this long to realize <em>‚ÄúThese are fun, and I learn a lot. I should turn them into short blogposts.‚Äù</em></p>
<p><center><iframe src="https://www.livecoding.tv/swizec/embed" width="560" height="315" frameborder="0" allowfullscreen="true" scrolling="no"></iframe></center></p>
<p>This Sunday, I started a new quest: To find the definitive answer to <em>&#8220;How do you smoothly animate 10,000 elements in React?‚Äù</em>.</p>
<p>Many people have asked me about this recently, and I realized I couldn‚Äôt give them a good answer. The best I could come up with was, <em>‚ÄúTry to render fewer nodes?‚Äù</em>. The issue is that sometimes you really <em>do</em> need that many nodes because you don‚Äôt want to sacrifice fidelity.</p>
<p>So I took my old <a href="http://swizec.com/blog/animating-with-react-redux-and-d3/swizec/6775">particle generator experiment</a> and started playing around. It doesn‚Äôt use a lot of d3, but it does rely heavily on React and Redux.</p>
<p>It works like this:</p>
<ul>
<li>React renders <code>&lt;circle&gt;</code> elements in a loop</li>
<li>Redux holds an array of <code>[x, y]</code> positions</li>
<li>Trigger a <code>move particles</code> action 60-times per second</li>
<li>Add new particles if mousedown</li>
</ul>
<p>If you change <code>N</code> particles per loop from 5 to 1,000, all hell breaks loose. Animation grinds to a halt.</p>
<img class="alignnone size-large wp-image-6834" src="http://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-1-1024x551.png" alt="livecoding-12-1" srcset="https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-1-1024x551.png 1024w, https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-1-300x161.png 300w, https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-1-768x413.png 768w" sizes="(max-width: 1024px) 100vw, 1024px" />
<p>To get to the bottom of <em>why</em> this happens, we fired up the profiler. There are two suspects:</p>
<ol>
<li>Creating new instances of the particles array 60-times per second</li>
<li>Rendering those DOM nodes</li>
</ol>
<p>The profiler wasn‚Äôt happy with us:</p>
<img class="alignnone size-large wp-image-6833" src="http://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-2-1024x521.png" alt="livecoding-12-2" srcset="https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-2-1024x521.png 1024w, https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-2-300x153.png 300w, https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-2-768x391.png 768w" sizes="(max-width: 1024px) 100vw, 1024px" />
<p>It seems that ‚Äúscripting‚Äù is the culprit, not rendering. In a 21 second experiment, 18 seconds were spent ‚Äúscripting‚Äù, and less than 2 were spent rendering. Curious.</p>
<p>This implies that copying the array is our big timesink. If this is true, then the fix is simple ‚Äì use <a href="https://facebook.github.io/immutable-js/">immutable.js</a>. Immutable.js promises to be smart about implementing proper immutable data structures efficiently.</p>
<p>We turned off rendering and kept the array copying. Things became silky smooth.</p>
<p>Curiouser and curiouser.</p>
<p>Looking deeper into the profiler reveals that the problem isn‚Äôt data management after all; it‚Äôs updating children, either in React or in the DOM.</p>
<img class="alignnone size-large wp-image-6832" src="http://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-3-1024x185.png" alt="livecoding-12-3" srcset="https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-3-1024x185.png 1024w, https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-3-300x54.png 300w, https://swizec.com/blog/wp-content/uploads/2016/06/livecoding-12-3-768x139.png 768w" sizes="(max-width: 1024px) 100vw, 1024px" />
<p>Interesting.</p>
<p>The next thing to try is finding the bottleneck in updating children. Is it React, or is it the DOM? We can figure that out by replacing React rendering with raw d3 rendering.</p>
<p>This had funny results. Particles didn‚Äôt update properly, the animation was glitchy, and there were staleness artifacts galore.</p>
<p>Looks like React <em>does</em> make our lives easier, despite how great d3 is on its own.</p>
<img class="aligncenter" src="http://i.imgur.com/Thz3F4K.gif" alt="" width="1102" height="577" />
<p>But it <em>is</em> faster.</p>
<p>Then we looked at <a href="https://github.com/chenglou/react-motion">react-motion</a> and <a href="https://github.com/reactjs/react-art">react-art</a>, and we decided that they don‚Äôt smell like they can solve our problem. Maybe I just need to invest more time into figuring them out.</p>
<p>React-motion did give us a great idea though ‚Äì use css transformations! The GPU renders those; that <em>has got to be fast</em>, right?</p>
<p>Nope. Not fast.</p>
<p>Looks like we do have to get away from the DOM completely. The most promising library we could find to do that was <a href="https://medium.com/@lavrton/using-react-with-html5-canvas-871d07d8d753#.lrwnvr1z6">react-koonva</a>.</p>
<p>I‚Äôm sure that <em>next time</em>, we will crack this nut. There <em>will</em> be 10,000 dancing dots on the screen.</p>
<p>It‚Äôs gonna be great.</p>
<hr />
<p>&nbsp;</p>
<p>PS:¬†<span class="s1">the edited and improved versions of these videos are becoming a video course. Readers of the engineer package of <a href="http://swizec.com/reactd3js#packages">React+d3js ES6</a> get it for free when it‚Äôs ready.</span></p>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-livecoding-12-towards-animating-10-k-elements-with-react-743","path":"/post/livecoding-12-towards-animating-10k-elements-with-react/"};window.dataPath="62/path---post-livecoding-12-towards-animating-10-k-elements-with-react-743-383-8DXKsflThuBp1gSsSS4ITirsw";/*]]>*/</script><script src="/swizecblog/webpack-runtime-b34af8fd410bb07c9828.js" async=""></script><script src="/swizecblog/app-49ff0b4ea28eff25fc3b.js" async=""></script><script src="/swizecblog/0-f215691c134019ee6fa5.js" async=""></script><script src="/swizecblog/component---src-components-post-js-dbedf083f25f7ad1f3b1.js" async=""></script></body></html>