<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecblog/component---src-components-post-js.345c7c4f16662f410581.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.345c7c4f16662f410581.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecblog/component---src-components-post-js-a296f4540b7641f60fd0.js"/><link as="script" rel="preload" href="/swizecblog/0-7538a10af02717828d76.js"/><link as="script" rel="preload" href="/swizecblog/app-e5d3c6935dd41a7392ed.js"/><link as="script" rel="preload" href="/swizecblog/webpack-runtime-fb9019140f39a903448b.js"/><link rel="preload" href="/swizecblog/static/d/968/path---post-levenshtein-distance-in-haskell-c-27-40a-n9soQHHCKYSII0cAp75SxXtfptk.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecblog/blog/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Thoughts/">Thoughts</a></ul></div><h1>Levenshtein distance in Haskell</h1><div><p>When you have to figure out the difference between two strings your best bet is either H<em>amming distance</em> or <em><a class="zem_slink" title="Levenshtein distance" href="http://en.wikipedia.org/wiki/Levenshtein_distance" rel="wikipedia" target="_blank">Levenshtein distance</a></em>.</p>
<p>Because <a class="zem_slink" title="Hamming distance" href="http://en.wikipedia.org/wiki/Hamming_distance" rel="wikipedia" target="_blank">hamming distance</a> only works on strings of equal lengths, you&#8217;re usually better off using levenshtein distance. Its name is also harder to spell so you know it&#8217;s better!</p>
<p>It is defined as <em>the minimum amount of edits needed to transform one string into another</em>. Like this:</p>
<blockquote>
<ol>
<li><strong>k</strong>itten → <strong>s</strong>itten (substitution of &#8216;s&#8217; for &#8216;k&#8217;)</li>
<li>sitt<strong>e</strong>n → sitt<strong>i</strong>n (substitution of &#8216;i&#8217; for &#8216;e&#8217;)</li>
<li>sittin → sittin<strong>g</strong> (insertion of &#8216;g&#8217; at the end).</li>
</ol>
</blockquote>
<p>Levenshtein distance also happens to be a great case for learning about dynamic programming, because one of the simplest implementations involves nothing more than keeping track of the already known distances and deciding whether you should increase that number for the next character.</p>
<p>Doing this in a 2D array is trivially simple because it lest you travel through the distance space very efficiently without forgetting that <em>kitten</em> and <em>kiten</em> only have a levenshtein distance of 1.</p>
<p>The meat of the algorithm goes like this:</p>
<pre lang="pseudo">      if s[i] = t[j] then  
        d[i, j] := d[i-1, j-1]       // no operation required
      else
        d[i, j] := minimum
                   (
                     d[i-1, j] + 1,  // a deletion
                     d[i, j-1] + 1,  // an insertion
                     d[i-1, j-1] + 1 // a substitution
                   )</pre>
<h2><a class="zem_slink" title="Dynamic programming" href="http://en.wikipedia.org/wiki/Dynamic_programming" rel="wikipedia" target="_blank">Dynamic programming</a> and Haskell</h2>
<p>Doing this in Haskell becomes tricky because we don&#8217;t have state so we can&#8217;t really keep track of what we already know. Translating this into a recursive problem is our only option.</p>
<p>The key insight comes from looking at what those index manipulations are doing &#8211; traveling in the space of two strings.</p>
<p>So, if we start from the other end of the &#8220;matrix&#8221; &#8211; bottom right instead of top left &#8211; we can express the levenshtein distance recursively:</p>
<ul>
<li>if last two characters are same, ignore them</li>
<li>otherwise take the minimum of ignoring either or both the last characters</li>
<li>recurse</li>
</ul>
<p>In Haskell the function ends up looking like this:</p>
<pre lang="haskell">-- calculate levenshtein distance between two strings
levenshtein::[Char] -> [Char] -> Int
levenshtein "" "" = 0
levenshtein "" s2 = length s2
levenshtein s1 "" = length s1
levenshtein s1 s2
   | last s1 == last s2 = levenshtein (init s1) (init s2)
   | otherwise = minimum [1 + levenshtein (init s1) s2,
                          1 + levenshtein s1 (init s2),
                          1 + levenshtein (init s1) (init s2)]</pre>
<p>Better Haskellers than me can probably write this a bit cleaner &#8211; for instance you don&#8217;t need the <em>levenshtein &#8220;&#8221; &#8220;&#8221; = 0</em> line, but I think it&#8217;s more readable when all the border cases are spelled out explicitly.</p>
<p>However, the problem is that this is incredibly slow when comparing a long string to a short one. So slow in fact, I never waited for the code to stop executing (takes 20s+).</p>
<p>Luckily, speeding up the code is trivial &#8211; look at those border cases. We can just handle those first and <em>then</em> go into the meaty algorithm!</p>
<p>The code becomes somewhat uglier to look at, but is usefully quick for all cases:</p>
<pre lang="haskell">-- calculate levenshtein distance between two strings
levenshtein::[Char] -> [Char] -> Int
-- this part is mostly a speed optimiziation
levenshtein s1 s2
  | length s1 > length s2 = levenshtein s2 s1
  | length s1 < length s2 =
    let d = length s2 - length s1
    in d + levenshtein s1 (take (length s2 - d) s2)
-- the meat of the algorithm
levenshtein "" "" = 0
levenshtein s1 s2
  | last s1 == last s2 = levenshtein (init s1) (init s2)
  | otherwise = minimum [1 + levenshtein (init s1) s2,
                         1 + levenshtein s1 (init s2),
                         1 + levenshtein (init s1) (init s2)]</pre>
<p>If anyone's got an even better idea for implementing Levenshtein distance in Haskell, I'd love to hear!</p>
<p>edit: A Reddit commenter provides a far better <a href="http://www.reddit.com/r/programming/comments/w4gs6/levenshtein_distance_in_haskell/c5a6jjz" target="_blank">Levenshtein distance function</a>.</p>
<h6 class="zemanta-related-title" style="font-size: 1em;">Related articles</h6>
<ul class="zemanta-article-ul zemanta-article-ul-image" style="margin-left: 0; display: inline-block; list-style-type: none;">
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://www.jefclaes.be/2012/01/autocorrecting-unknown-actions-using.html" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/87510074_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://www.jefclaes.be/2012/01/autocorrecting-unknown-actions-using.html" target="_blank">Autocorrecting unknown actions using the Levenshtein distance</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://stackoverflow.com/questions/5859561/getting-the-closest-string-match" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/87174255_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://stackoverflow.com/questions/5859561/getting-the-closest-string-match" target="_blank">Incredibly thorough response to a Fuzzy String Search question on SO</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://cs.stackexchange.com/questions/2093/efficient-map-data-structure-supporting-approximate-lookup" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/91010017_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://cs.stackexchange.com/questions/2093/efficient-map-data-structure-supporting-approximate-lookup" target="_blank">Efficient map data structure supporting approximate lookup</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;"><a href="http://stackoverflow.com/questions/5859561/getting-the-closest-string-match/5859691" target="_blank"><img style="padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;" src="http://i.zemanta.com/87179321_80_80.jpg" alt="" /></a><a style="display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;" href="http://stackoverflow.com/questions/5859561/getting-the-closest-string-match/5859691" target="_blank">Answer by adorablepuppy for Getting the closest string match</a>
<div style="clear: both; margin: 10px 0 10px 0;">
<hr style="margin: 0;" />
</div>
</li>
</ul>
<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;"><a class="zemanta-pixie-a" title="Enhanced by Zemanta" href="http://www.zemanta.com/?px"><img class="zemanta-pixie-img" style="border: none; float: right;" src="http://img.zemanta.com/zemified_e.png?x-id=350fa2c4-f571-457e-a891-22f73c43d8a7" alt="Enhanced by Zemanta" /></a></div>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-levenshtein-distance-in-haskell-c27","path":"/post/levenshtein-distance-in-haskell/"};window.dataPath="968/path---post-levenshtein-distance-in-haskell-c-27-40a-n9soQHHCKYSII0cAp75SxXtfptk";/*]]>*/</script><script src="/swizecblog/webpack-runtime-fb9019140f39a903448b.js" async=""></script><script src="/swizecblog/app-e5d3c6935dd41a7392ed.js" async=""></script><script src="/swizecblog/0-7538a10af02717828d76.js" async=""></script><script src="/swizecblog/component---src-components-post-js-a296f4540b7641f60fd0.js" async=""></script></body></html>