<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecblog/component---src-components-post-js.345c7c4f16662f410581.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.345c7c4f16662f410581.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecblog/component---src-components-post-js-352e8466f0cbd742adc0.js"/><link as="script" rel="preload" href="/swizecblog/0-7538a10af02717828d76.js"/><link as="script" rel="preload" href="/swizecblog/app-e5d3c6935dd41a7392ed.js"/><link as="script" rel="preload" href="/swizecblog/webpack-runtime-bf7869bd5fe0e771eaf7.js"/><link rel="preload" href="/swizecblog/static/d/583/path---post-game-development-in-webgl-a-34-c40-XHznTEPeD0BnjabpIpXnQZMlIY.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecblog/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Thoughts/">Thoughts</a></ul></div><h1>Game development in Webgl</h1><div><a href="http://swizec.com/blog/wp-content/uploads/2012/11/Screen-Shot-2012-11-19-at-8.55.30-PM.png"><img class="alignnone  wp-image-5581" title="Game screen" src="http://swizec.com/blog/wp-content/uploads/2012/11/Screen-Shot-2012-11-19-at-8.55.30-PM-1024x737.png" alt="Game screen" width="614" height="442" srcset="https://swizec.com/blog/wp-content/uploads/2012/11/Screen-Shot-2012-11-19-at-8.55.30-PM-1024x737.png 1024w, https://swizec.com/blog/wp-content/uploads/2012/11/Screen-Shot-2012-11-19-at-8.55.30-PM-300x216.png 300w, https://swizec.com/blog/wp-content/uploads/2012/11/Screen-Shot-2012-11-19-at-8.55.30-PM.png 1033w" sizes="(max-width: 614px) 100vw, 614px" /></a>
<p><em>This is a guestpost from <a href="http://twitter.com/smotko" target="_blank">@Smotko</a>, he does cool things with code and runs my favourite irc channel.</em></p>
<p>I’ve started working on a simple game for the Github Game Off competition and I’d like to share my thoughts and findings on creating games with javascript and <a class="zem_slink" title="WebGL" href="http://www.khronos.org/webgl/" rel="homepage" target="_blank">Webgl</a>. I will not go into Webgl details, as there is a great number of tutorials that do just that, instead I’ll talk about some of the concepts that I used to make my game. You give <a href="http://psywerx.github.com/game-off-2012/" target="_blank">the game</a> a spin before you start reading, as I’ll be talking about how I implemented a few features and it will be easier for you to follow.</p>
<p>First of all, why did I choose Webgl? We have canvas, which is full of awesomeness and really easy to use and understand. Webgl, on the other hand, is quite the opposite. There is no drawRect function and in order to draw a simple triangle you need to write ~100 lines of javascript plus a few lines of C like shader code. Drawing textures is not simple either, you need to understand uv texture mapping and concepts such as mipmapping. It’s not a walk in the park. But if you do all the heavy lifting you are rewarded with an application that can have complex 3D models, lightning and it all runs on your graphics card and is therefore insanely fast.</p>
<h2>Structuring your code</h2>
<p>Most gl tutorials never ever tell you how to structure your code. The code is usually packed into a single file, which is OK for a tutorial, but fails miserably as soon as you’ll want to do anything serious. I’ve set up my project into 3 javascript files <code>main.js</code>, <code>game.js</code> and <code><a class="zem_slink" title="X Window System core protocol" href="http://en.wikipedia.org/wiki/X_Window_System_core_protocol" rel="wikipedia" target="_blank">drawables</a>.js</code>. <code>main.js</code> sets everything up. It binds keyevents, creates the shaders, loads the textures and sets up the game object. <code>game.js</code> is where my game object resides. It holds a list of current objects on screen, a list of idle objects off screen and also variables spacifying its state (paused, playing, menu,..), score, gameSpeed (which increases over time) and so on. The <code>drawables.js</code> is where my object hierarchy is defined. I could use a new file for each drawable object, but because each .js file is a new http request (and I can’t be bothered with minifying and/or asynchronous loading) it seemed like a good compromise. At the bottom of the hierarchy I have a simple Square object. A Square has a position, a size, velocity and optionally a texture. Other drawable objects use the Square object to draw their components. As an example the Player object is made of two Square objects. One for the main player model and one for the fork. The fork object is hidden most of the time, but it shows up when the player gets the fork powerup.</p>
<h2>The draw and update functions</h2>
<p>The most important parts of every gl application are the draw and update functions. The update function is where new positions and states of all the objects are calculated. In addition, collisions between objects are checked and user input is processed. All of my drawable objects have an update function. And this update functions is called one time per frame. The update function has one very important parameter &#8211; theta. Theta is the time difference between the previous frame and this one. This is necessary as the update functions is not going to be called as often on slow machines as on fast machines and without theta to balance things out, players on fast machines would see objects move faster than players on slower ones. This is why all position updates are being multiplied by theta &#8211; to insure all the players have the same experience.</p>
<p>All of the drawables, unsurprisingly, have a draw function. The draw functions uses the current position of the object to draw the object on screen. As an example, the draw functions of the Square object initializes the vertex, color and texture buffers, sets the shader variables and draws the needed triangles (two of them) so that we get a square. It does all the hard work so all the other drawables don’t have to. Because all of my drawables are stupidly simple &#8211; made from just a few squares, their draw functions are trivial. Here is an example of the draw function in my Background object:</p>
<pre lang="javascript">topBar.draw(gl);
score.draw(gl);</pre>
<p>topBar is a Square object, while score is a bunch Square objects &#8211; one for each digit.</p>
<h2>Collision detection</h2>
<p>I have made my life really simple in regards to <a class="zem_slink" title="Collision detection" href="http://en.wikipedia.org/wiki/Collision_detection" rel="wikipedia" target="_blank">collision detection</a>. All of my objects are essentially squares and I am only checking for collisions between the block objects and the player. This is the function that tells me if two of my objects are colliding:</p>
<pre lang="javascript">areColliding : function(a, b){
	for (var i=1; i&gt;=0; i--)
		if(a.position[i] + a.size[i]*a.collisionModifier &lt; b.position[i] - b.size[i] * b.collisionModifier ||
		   a.position[i] - a.size[i]*a.collisionModifier &gt;  b.position[i] + b.size[i] * b.collisionModifier)
			return false;
	return true;
}</pre>
<p>The collisionModifier is interesting because it allows me to make an object bigger or smaller than it actually is.</p>
<h2>Rendering text</h2>
<div id="attachment_5579" style="width: 522px" class="wp-caption alignnone"><a href="http://swizec.com/blog/wp-content/uploads/2012/11/text.png"><img class="size-full wp-image-5579" title="Sprites" src="http://swizec.com/blog/wp-content/uploads/2012/11/text.png" alt="Sprites" width="512" height="512" srcset="https://swizec.com/blog/wp-content/uploads/2012/11/text.png 512w, https://swizec.com/blog/wp-content/uploads/2012/11/text-150x150.png 150w, https://swizec.com/blog/wp-content/uploads/2012/11/text-300x300.png 300w" sizes="(max-width: 512px) 100vw, 512px" /></a><p class="wp-caption-text">Sprites</p></div>
<p>Printing text in <a class="zem_slink" title="OpenGL" href="http://www.opengl.org/" rel="homepage" target="_blank">OpenGL</a> is not as easy as one would think. It’s usually done by creating a <a class="zem_slink" title="Texture atlas" href="http://en.wikipedia.org/wiki/Texture_atlas" rel="wikipedia" target="_blank">texture atlas</a> with all the characters that you intend to use. When you have your atlas texture loaded, you need to calculate the correct <a class="zem_slink" title="UV mapping" href="http://en.wikipedia.org/wiki/UV_mapping" rel="wikipedia" target="_blank">uv coordinates</a> for each character or sprite in the atlas. I’ve created a helper function that calculates the uv coordinates, I only need to specify the sprite offset and the size:</p>
<pre lang="javascript">getTextureUV : function(offset, size){
	var textureWidth = [0.03125*size[0], 0.03125*size[1]];
	var u = offset[0]/size[0];
	var v = offset[1]/size[1];
	return [
		// <a class="zem_slink" title="Texture mapping" href="http://en.wikipedia.org/wiki/Texture_mapping" rel="wikipedia" target="_blank">Mapping</a> coordinates for the vertices
		(u + 1) * textureWidth[0],  v * textureWidth[1], 
		 u      * textureWidth[0],  v * textureWidth[1],
		(u + 1) * textureWidth[0], (v + 1) * textureWidth[1], 
		 u      * textureWidth[0], (v + 1) * textureWidth[1], 
	];
}</pre>
<p>And now that I can easily access each sprite in the atlas, I can easily draw a character. The size of a character is always one, and I get the position by calling the following function:</p>
<pre lang="javascript">fromChar : function(c){
	var charIndex = c.charCodeAt(0) - 32;
	return [(charIndex % NUM_SPRITES), Math.floor(charIndex / NUM_SPRITES)];
}</pre>
<h2>Fin</h2>
<p>I’ve learned one more important thing while making this game. Creating games is way more fun than playing them. I got stoked when my game started working and I could move the my in game character across the screen. It’s an incredible feeling that every programmer should experience.</p>
<p>You can take a look at the actual source code <a href="https://github.com/Smotko/game-off-2012" target="_blank">here</a>. If you have any questions feel free to ask me in the comments or on <a href="https://plus.google.com/u/0/109772113087805631318/posts" target="_blank">google+</a> and please let me know if I did something horribly wrong, I want to learn from my mistakes and become batter at this crazy game development thing!</p>
<h6 class="zemanta-related-title" style="font-size: 1em;">Related articles</h6>
<ul class="zemanta-article-ul zemanta-article-ul-image" style="margin: 0; padding: 0; overflow: hidden;">
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://radar.oreilly.com/2012/10/the-promise-of-webgl.html" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/noimg_55_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://radar.oreilly.com/2012/10/the-promise-of-webgl.html" target="_blank">The promise of WebGL &#8211; O&#8217;Reilly Radar</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://stackoverflow.com/questions/13325718/android-drawables-showing-black-rectangles" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/noimg_69_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://stackoverflow.com/questions/13325718/android-drawables-showing-black-rectangles" target="_blank">Android: Drawables showing black rectangles</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://www.gamasutra.com/view/news/177857/Building_an_HTML5_game_Dont_shrug_off_atlases.php" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/113134040_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://www.gamasutra.com/view/news/177857/Building_an_HTML5_game_Dont_shrug_off_atlases.php" target="_blank">Building an HTML5 game? Don&#8217;t shrug off atlases</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://www.i-programmer.info/bookreviews/6-graphics/4913-webgl-up-and-running.html" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/noimg_61_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://www.i-programmer.info/bookreviews/6-graphics/4913-webgl-up-and-running.html" target="_blank">WebGL: Up and Running</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://www.hsharma.com/games/hungry-hero-goes-open-source/" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/125140677_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://www.hsharma.com/games/hungry-hero-goes-open-source/" target="_blank">Hungry Hero goes Open Source</a></li>
</ul>
<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;"><a class="zemanta-pixie-a" title="Enhanced by Zemanta" href="http://www.zemanta.com/?px"><img class="zemanta-pixie-img" style="border: none; float: right;" src="http://img.zemanta.com/zemified_e.png?x-id=df679669-f18c-4dd9-aa88-18a88e95861b" alt="Enhanced by Zemanta" /></a></div>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-game-development-in-webgl-a34","path":"/post/game-development-in-webgl/"};window.dataPath="583/path---post-game-development-in-webgl-a-34-c40-XHznTEPeD0BnjabpIpXnQZMlIY";/*]]>*/</script><script src="/swizecblog/webpack-runtime-bf7869bd5fe0e771eaf7.js" async=""></script><script src="/swizecblog/app-e5d3c6935dd41a7392ed.js" async=""></script><script src="/swizecblog/0-7538a10af02717828d76.js" async=""></script><script src="/swizecblog/component---src-components-post-js-352e8466f0cbd742adc0.js" async=""></script></body></html>