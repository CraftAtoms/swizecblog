<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecblog/component---src-components-post-js.345c7c4f16662f410581.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.345c7c4f16662f410581.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecblog/component---src-components-post-js-dbedf083f25f7ad1f3b1.js"/><link as="script" rel="preload" href="/swizecblog/0-f215691c134019ee6fa5.js"/><link as="script" rel="preload" href="/swizecblog/app-49ff0b4ea28eff25fc3b.js"/><link as="script" rel="preload" href="/swizecblog/webpack-runtime-b34af8fd410bb07c9828.js"/><link rel="preload" href="/swizecblog/static/d/572/path---post-livecoding-38-faux-ai-writes-javascript-25-d-c70-lO4IrgfFxVQaUGpcZpu06ELbAo.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecblog/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Thoughts/">Thoughts</a></ul></div><h1>Livecoding #38 &#8211; A faux AI that writes JavaScript</h1><div><p><em>This is a Livecoding Recap – an almost-weekly post about interesting things discovered while livecoding. Usually shorter than 500 words. Often with pictures. Livecoding happens almost <strong>every Sunday at 2pm PDT</strong> on multiple channels. You should follow <a href="https://www.youtube.com/channel/UCoyHgaeLLI7Knp7LDHOwZMw">My Youtube</a> channel to catch me live.</em></p>
<p><iframe width="853" height="480" src="https://www.youtube.com/embed/N_k1c0sed_w" frameborder="0" allowfullscreen></iframe></p>
<blockquote class="twitter-tweet" data-width="550">
<p lang="en" dir="ltr"><a href="https://twitter.com/aJimHolmes">@aJimHolmes</a> <a href="https://twitter.com/QualityFrog">@QualityFrog</a> Really what we need is AI. We write the tests, AI builds code that passes.</p>
<p>True test driven development!</p>
<p>&mdash; Swizec (@Swizec) <a href="https://twitter.com/Swizec/status/865295043162021889">May 18, 2017</a></p></blockquote>
<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
<p>Think about how a product manager writes code.</p>
<p>They define some features, come up with constraints, and unleash a team of engineers. A few days pass while stuff they don&#8217;t understand goes on, and voilà! New features with working code and business metrics twitching to and fro as users respond to new goodies.</p>
<p>Great, huh?</p>
<p>Now think about how a software engineer writes code.</p>
<p>They talk to the product manager and get a <em>&#8220;This is what it should do&#8221;</em> spec, then they agree on <em>&#8220;This is how much it should cost in time/resources to build&#8221;</em>. Then the engineer looks at existing code and gets a <em>&#8220;This is the code the new stuff should fit into&#8221;</em>. Then they come up with a set of tests, automated or otherwise, that answer the question, <em>&#8220;Does it work yet?&#8221;</em></p>
<p>With tests in hand, the engineer sets to work. Painstakingly manipulating characters on screen, typing and typing and running and testing and eventually they have code that is syntactically correct and doesn&#8217;t break existing stuff and implements the new stuff. Hooray!</p>
<p>Great, huh?… kinda tedious 🤔</p>
<p>Your core value add as an engineer is to help the product manager come up with sensible constraints. To help them include the new stuff into the existing stuff. To suggest constraints they didn&#8217;t think of. And to add constraints they shouldn&#8217;t have to worry about.</p>
<p>All that code writing stuff… meh.</p>
<p>I know, it&#8217;s not just typing. It takes smarts and experience, and it&#8217;s really hard to do well. But if you had good tests and infinite memory and infinite time, you could keep generating random strings until one of them happened to make the tests pass. You&#8217;d call that string The Code.</p>
<p>Similar idea as the <a href="https://en.wikipedia.org/wiki/Monkey_typewriter_theory">monkeys with typewriters</a> thought experiment and the <a href="https://en.wikipedia.org/wiki/Bogosort">random sort algorithm</a>. Do random stuff until requirements are met.</p>
<p>Expected running time: Infinity.</p>
<p>Because you&#8217;re smart and experienced and a grizzled veteran or an eager newbie, it takes you less than infinity to write that code. You use smart heuristics like <em>&#8220;not typing random stuff&#8221;</em> and <em>&#8220;actually thinking about what to do&#8221;</em>.</p>
<p>Although I often just keep trying random things when things get really tough. 😇</p>
<p>Wouldn&#8217;t it be cool if someone could do that for you? I mean, if <a href="https://www.wired.com/2015/10/this-news-writing-bot-is-now-free-for-everyone/">computers can write news</a>, why not the code that makes computers write news?</p>
<p>Here&#8217;s the idea: You write the tests, AI makes them pass.</p>
<h2>Experiment 1 &#8211; failed</h2>
<p>I&#8217;m calling this first experiment “faux AI” because it doesn&#8217;t know what it&#8217;s doing. The current approach is at the <em>&#8220;Paste random characters and fingers crossed&#8221;</em> stage.</p>
<p>We tried an <a href="https://en.wikipedia.org/wiki/Evolutionary_algorithm">evolutionary algorithm</a> based on manipulating code as character strings. This did not work.</p>
<p>Our population kept getting stuck at a maximum far away from the result. Once every member of the population had the same fitness score, they stopped changing and a solution was never reached.</p>
<p>The situation improved once we tweaked our fitness function and added constraint weights. Instead of having a series of <code>true</code>/<code>false</code> conditions, we weighted them by importance.</p>
<pre lang="javascript">
// We aim to maximize this value
function fitness(code, conditions) {
    const max = conditions.reduce((sum, { condition, weight }) => sum + weight,
                                  0),
          fit = conditions.map(({ condition, weight }) => Number(condition(code))*weight)
                          .reduce((sum, fit) => sum + fit,
                                  0);

    return fit/max;
}

const Conditions = [
    {
        condition: code => !(run(code) instanceof Error),
        weight: 10
    },
    {
        condition: code => run(code) === 4,
        weight: 8
    },
    {
        condition: code => code !== "4",
        weight: 2
    },
    {
        condition: code => code !== 4,
        weight: 2
    },
    {
        condition: code => code.length > 4 ? 4/code.length : 1,
        weight: 6
    }
];
</pre>
<p>The <code>fitness</code> function takes a piece of code and walks through a set of <code>conditions</code>. We test each condition and multiply the result with its weight. A syntactically valid piece of code gets <code>10</code>, an invalid one gets <code>0</code>. One that produces the correct result gets<code>8</code>, an invalid result gets <code>0</code>, etc.</p>
<p>We&#8217;re looking for code that is shorter than <code>4</code> characters, isn&#8217;t <code>4</code> or <code>"4"</code>, and returns <code>4</code>. A good solution would be, say, <code>2+2</code>, or <code>1+3</code>. Even <code>a = 4</code> works. Or maybe <code>"afwaelfjlkwefj"; 4</code>.</p>
<p>The tricky part of evolutionary algorithms is that even when they work, their results are weird. Best things in the world at finding loopholes in your conditions.</p>
<p>Our evolutionary algorithm looks like this:</p>
<pre lang="javascript">
function* generation({ population, fitness, N }) {
    while (true) {
        population = rank(population, fitness);

        // pairwise breed top 50% of population
        population = population.concat(
            breedPairs(_.chunk(_.take(population,
                                 population.length/2),
                          2)
            ));

        population = rank(population, fitness);

        population = _.take(population, BIGGEST_POPULATION);

        yield {
            fitness: fitness(population[0], Conditions),
            code: population[0],
            fitnessLast: fitness(population[population.length-1], Conditions),
            codeLast: population[population.length-1],
            size: population.length
        };
    }
}
</pre>
<p>That&#8217;s a generator, by the way. Call <code>.next()</code> to get the next generation from the current population. Call it as many times as you want; it keeps working 🙂</p>
<p>Each <code>generation</code> starts with an existing <code>population</code>, which is ranked by the <code>fitness</code> function. We make pairs out of the best 50% of the specimens, breed them, and add their offspring to the population.</p>
<p>The new population is again ranked, and if there&#8217;s more specimen than we have room for, the bottom few are thrown away. They&#8217;re useless.</p>
<p>You can see how the <code>breedPairs</code> and <code>rank</code> functions work <a href="https://github.com/Swizec/faux-js-ai">on Github</a>.</p>
<p>This current approach did not produce a single working piece of code. This was the best solution with a score of <code>0.5535714285714286</code></p>
<pre><code>" pci  s |ePke "
</code></pre>
<p>At least it&#8217;s syntactically valid 🤔</p>
<p>This field of research is known as <a href="https://en.wikipedia.org/wiki/Genetic_programming">genetic programming</a>. I don&#8217;t think anyone has gotten it to the point of replacing software engineers yet, but I remember a cool project from my high school days by some Slovenian person called <a href="http://www.critticall.com/">Critticall</a>. It was able to invent novel sorting algorithms.</p>
<h2>Next steps</h2>
<p>The experiment failed, and the code is slow.</p>
<p>Maybe we should switch to Python? Or parallelize the generation generator. Evolution is, after all, highly parallelizable and there <em>are</em> 4 cores in my computer…</p>
<p>Fundamentally, we&#8217;re gonna have to change the level of abstraction. You cannot evolve code as if it was a random series of characters. Maybe if our algorithm could understand syntax, or at least JavaScript symbols, and evolve an <a href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</a>, then it might work.</p>
<p>I think there&#8217;s also room for neural nets and deep learning in the evolution step. 🤔</p>
<p>Ideas very welcome. I will continue to dabble with this as time allows.</p>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-livecoding-38-faux-ai-writes-javascript-25d","path":"/post/livecoding-38-faux-ai-writes-javascript/"};window.dataPath="572/path---post-livecoding-38-faux-ai-writes-javascript-25-d-c70-lO4IrgfFxVQaUGpcZpu06ELbAo";/*]]>*/</script><script src="/swizecblog/webpack-runtime-b34af8fd410bb07c9828.js" async=""></script><script src="/swizecblog/app-49ff0b4ea28eff25fc3b.js" async=""></script><script src="/swizecblog/0-f215691c134019ee6fa5.js" async=""></script><script src="/swizecblog/component---src-components-post-js-dbedf083f25f7ad1f3b1.js" async=""></script></body></html>