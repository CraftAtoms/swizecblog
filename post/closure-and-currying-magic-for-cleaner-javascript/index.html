<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecblog/component---src-components-post-js.15d6bfea4d3b992d9691.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";-webkit-font-kerning:normal;font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.15d6bfea4d3b992d9691.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecblog/component---src-components-post-js-428e04eacc0b402938d5.js"/><link as="script" rel="preload" href="/swizecblog/0-20c56a8bf68923b243f7.js"/><link as="script" rel="preload" href="/swizecblog/app-f4c654d11b4415967aef.js"/><link as="script" rel="preload" href="/swizecblog/webpack-runtime-559e9e27cf35c66d2ba0.js"/><link rel="preload" href="/swizecblog/static/d/937/path---post-closure-and-currying-magic-for-cleaner-javascript-c-12-828-gC1ts1yK4hkUl8SDHJWXMaGuGd0.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecblog/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Thoughts/">Thoughts</a></ul></div><h1>Closure and currying magic for cleaner javascript</h1><div><p>Sometimes you find a piece of <a class="zem_slink" title="JavaScript" href="http://en.wikipedia.org/wiki/JavaScript" rel="wikipedia">javascript</a>, a perfect piece of javascript, it does <em>exactly</em> what you need! Perfect! You could spend hours, even days, getting something to work and someone&#8217;s already done it, shared the code on the internets even!</p>
<p>Hooray!</p>
<p>But &#8230; the code looks something like this:</p>
<pre lang="javascript">// to populate later
var data = [], oldData = [], semiOldData = [];
var a_switch = "blah";

function do_something() {
   // use subset of globals
}

function something_else() {
   // use some other globals
}

// etc.

function update() {
  // use all of the above
}</pre>
<p>The code works &#8230; if you only need to use it once. What if you need two independent widgets? Well, you could take the time to recode all of that so it becomes <a class="zem_slink" title="Purely functional" href="http://en.wikipedia.org/wiki/Purely_functional" rel="wikipedia">purely functional</a>.</p>
<p>But that&#8217;s going to be a problem &#8211; the code heavily relies on state. Ok maybe object oriented? Object oriented kind of sucks in javascript and you&#8217;d have to recode all of that, have to perfectly understand it etc.</p>
<p>Pain in the arse!</p>
<h2>Closure magic</h2>
<p>There&#8217;s a better way &#8211; put it in a closure.</p>
<pre lang="javascript">var my_widget = (function (data_function) {
// to populate later
var data = [], oldData = [], semiOldData = [];
var an_index = 1;

function do_something() {
   // use subset of globals
}

function something_else() {
   // use some other globals
}

// etc.

function update(index) {
  an_index = index;
  data = data_function();
  // use all of the above
}

return update;
});</pre>
<p>Now you get to create the widget with a simple function call. Hooray!</p>
<p>And the function returns its own update function so you can run an update whenever you need. All the state and weirdness is neatly packaged inside the closure, the code itself doesn&#8217;t need to know anything about the outside state.</p>
<p>By changing the update function a little bit you can even affect the internal state of the closure by calling the <a class="zem_slink" title="Currying" href="http://en.wikipedia.org/wiki/Currying" rel="wikipedia">curried function</a>.</p>
<h2>Closures upon <a class="zem_slink" title="Closure (computer science)" href="http://en.wikipedia.org/wiki/Closure_%28computer_science%29" rel="wikipedia">closures</a></h2>
<p>Here&#8217;s where it gets even more magical. Stacking closures to achieve true greatness.</p>
<p>Code is the best way to explain what I mean &#8230;</p>
<pre lang="javascript">// these functions are used to slice up data
var slice_functions = {
        students: function (item) { return !!item.cs_student; },
        others: function (item) { return !item.cs_student; },
        everyone: function (item) { return true; }
    },
        slice_func = slice_functions.students,

// these functions provide cleaned up data
// all must use the same main slice_func
        data_functions = {
            year_vs_pay: function (year) {
                var data = DATA.filter(slice_func).filter(function (item) {
                    return item.years_study == year;
                }),
                // ...
                return fin_data;
            },
            study_vs_pay: function (study) {
                var data = DATA.filter(slice_func).filter(function (item) {
                    return item.study_time == study;
                }),
                // ...
                return fin_data;
            },
            // ...</pre>
<p>Those are our data functions, when creating new widgets we can provide them as the <em>data_function</em> argument shown above.</p>
<p>Now comes the tricky part &#8211; we can externally change the <em>slice_func</em> and all the data_functions (now safely tucked inside closures) <strong>change</strong> their behaviour by using the new slice_function since variables inside closures are pointers rather than copies.</p>
<p>Magic!</p>
<p>We have reached a situation where all code is tucked neatly inside closures. The closures themselves have no knowledge of the outside world, there are no flags they need to check, no external data anywhere. All they care about is running the data function and doing their thing.</p>
<p>And yet, through the magic of closures, we get to globally change their behaviour without worrying about internal state <em>or</em> having to call a specific function to do something on an object.</p>
<p>To me this feels cleaner than any abstraction <a class="zem_slink" title="Object-oriented programming" href="http://en.wikipedia.org/wiki/Object-oriented_programming" rel="wikipedia">object oriented programming</a> has ever come up with.</p>
<h6 class="zemanta-related-title" style="font-size: 1em;">Related articles</h6>
<ul class="zemanta-article-ul">
<li class="zemanta-article-ul-li"><a href="http://www.adafruit.com/blog/2012/03/14/breakout-connect-your-arduino-sensors-and-actuators-to-javascript/">Breakout &#8211; Connect your Arduino sensors and actuators to javascript</a> (adafruit.com)</li>
<li class="zemanta-article-ul-li"><a href="http://stackoverflow.com/questions/9684105/calling-javascript-functions-from-a-java-applet">Calling Javascript functions from a Java Applet</a> (stackoverflow.com)</li>
<li class="zemanta-article-ul-li"><a href="http://swizec.com/blog/the-commonest-javascript-bug/swizec/3740">The commonest javascript bug</a> (swizec.com)</li>
<li class="zemanta-article-ul-li"><a href="http://www.websanova.com/tutorials/jquery/building-collections-efficiently-using-jquery">Building Collections Efficiently Using jQuery</a> (websanova.com)</li>
<li class="zemanta-article-ul-li"><a href="http://www.websanova.com/tutorials/jquery/10-coding-tips-to-write-superior-jquery-plugins">10 Coding Tips to Write Superior jQuery Plugins</a> (websanova.com)</li>
<li class="zemanta-article-ul-li"><a href="http://stackoverflow.com/questions/9058248/good-examples-for-using-a-closure-in-javascript">Good examples for using a Closure in Javascript</a> (stackoverflow.com)</li>
<li class="zemanta-article-ul-li"><a href="http://lostechies.com/derekgreer/2012/02/17/javascript-closures-explained/">JavaScript Closures Explained</a> (lostechies.com)</li>
</ul>
<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;"><a class="zemanta-pixie-a" title="Enhanced by Zemanta" href="http://www.zemanta.com/"><img class="zemanta-pixie-img" style="border: none; float: right;" src="http://img.zemanta.com/zemified_e.png?x-id=dd5a4e07-700e-44df-b113-8195cf2d3133" alt="Enhanced by Zemanta" /></a></div>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-closure-and-currying-magic-for-cleaner-javascript-c12","path":"/post/closure-and-currying-magic-for-cleaner-javascript/"};window.dataPath="937/path---post-closure-and-currying-magic-for-cleaner-javascript-c-12-828-gC1ts1yK4hkUl8SDHJWXMaGuGd0";/*]]>*/</script><script src="/swizecblog/webpack-runtime-559e9e27cf35c66d2ba0.js" async=""></script><script src="/swizecblog/app-f4c654d11b4415967aef.js" async=""></script><script src="/swizecblog/0-20c56a8bf68923b243f7.js" async=""></script><script src="/swizecblog/component---src-components-post-js-428e04eacc0b402938d5.js" async=""></script></body></html>