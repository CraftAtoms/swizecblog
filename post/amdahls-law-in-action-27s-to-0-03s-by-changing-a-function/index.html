<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/swizecblog/component---src-components-post-js.345c7c4f16662f410581.css">@import url(https://fonts.googleapis.com/css?family=Lora);
html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:Lora,serif}body{background-color:#f6f6f6;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:Lora,serif;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font:112.5%/1.45em georgia,serif;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{-moz-font-feature-settings:"kern","liga","clig","calt";-ms-font-feature-settings:"kern","liga","clig","calt";-webkit-font-feature-settings:"kern","liga","clig","calt";color:rgba(0,0,0,.8);font-family:Lora,serif;font-feature-settings:"kern","liga","clig","calt";font-kerning:normal;font-weight:400;word-wrap:break-word}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1{font-size:2.25rem}h1,h2{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{color:inherit;font-family:Lora,serif;font-weight:700;line-height:1.1;margin:0 0 1.45rem;padding:0;text-rendering:optimizeLegibility}h6{font-size:.78405rem}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,figure,p{margin:0 0 1.45rem;padding:0}pre{background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;margin:0 0 1.45rem;overflow:auto;padding:1.45rem;word-wrap:normal}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{margin:0 1.45rem 1.45rem;padding:0}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:Lora,serif;padding:.2em 0}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{content:" ";letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}@media only screen and (max-width:480px){html{font-size:100%}}

/*# sourceMappingURL=component---src-components-post-js.345c7c4f16662f410581.css.map*/</style><style data-styled-components="cEsjyT hklXLQ gpHXOM cTUdjA">
/* sc-component-id: sc-bdVaJa */
.cEsjyT{margin:3rem auto;max-width:960px;padding:1.25rem 1rem;} .cEsjyT ul{margin:0 0 0px 0;list-style:none;float:right;}
/* sc-component-id: sc-bwzfXH */
.cTUdjA{-webkit-text-decoration:none;text-decoration:none;text-align:right;margin:0 .5rem 0 .5rem;padding:10px;color:#7c51a1;} .cTUdjA:hover{color:#fff;background-color:#7c51a1;}
/* sc-component-id: sc-htpNat */
.gpHXOM{-webkit-text-decoration:none;text-decoration:none;color:black;} .gpHXOM:hover{-webkit-text-decoration:underline;text-decoration:underline;color:#7c51a1;} .gpHXOM h3{display:inline;font-size:30px;}
/* sc-component-id: sc-bxivhb */
.hklXLQ{margin:0 3rem 4.5rem;}</style><title data-react-helmet="true">Swizec Blog</title><meta data-react-helmet="true" name="description" content="Sample"/><meta data-react-helmet="true" name="keywords" content="sample, something"/><link as="script" rel="preload" href="/swizecblog/component---src-components-post-js-9d5fb6538e5aeddeb728.js"/><link as="script" rel="preload" href="/swizecblog/0-ed8d8080a34ece5ef8f5.js"/><link as="script" rel="preload" href="/swizecblog/app-8e5a12ea225b4ed6ef6a.js"/><link as="script" rel="preload" href="/swizecblog/webpack-runtime-5246e3ca1a8c4f82e8dd.js"/><link rel="preload" href="/swizecblog/static/d/305/path---post-amdahls-law-in-action-27-s-to-0-03-s-by-changing-a-function-bf-9-656-rUf5Sd6h0jJZKbTVNe7GDKMwp4o.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div><div class="sc-bdVaJa cEsjyT"><div class="sc-bxivhb hklXLQ"><a class="sc-htpNat gpHXOM" href="/swizecblog/blog/"><h3>Swizec Teller</h3></a><ul><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Business/">Business</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Personal/">Personal</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Technical/">Technical</a><a class="sc-bwzfXH cTUdjA" href="/swizecblog/Thoughts/">Thoughts</a></ul></div><h1>Amdahl&#8217;s law in action &#8211; 27s to 0.03s by changing a function</h1><div><p>Perhaps the most important lesson I&#8217;ve learned while studying computer science is that of <a class="zem_slink" title="Amdahl's law" href="http://en.wikipedia.org/wiki/Amdahl%27s_law" rel="wikipedia" target="_blank">Amdahl&#8217;s law</a>.</p>
<div style="width: 310px" class="wp-caption alignright"><a href="http://commons.wikipedia.org/wiki/File:AmdahlsLaw.png" target="_blank"><img class="zemanta-img-inserted zemanta-img-configured" title="Graph Illustrating Amdahl's Law" src="http://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/AmdahlsLaw.png/300px-AmdahlsLaw.png" alt="Graph Illustrating Amdahl's Law" width="300" height="220" /></a><p class="wp-caption-text">Graph Illustrating Amdahl&#39;s Law (Photo credit: Wikipedia)</p></div>
<img class="alignnone" title="Amdahl's law" src="http://upload.wikimedia.org/wikipedia/en/math/8/9/6/89638a25639297d701f9298b68ee9cec.png" alt="Amdahl's law" width="104" height="49" />
<p>Amdahl&#8217;s law is generally used to predict the maximum speedup by improving a single component of a system (say, a function or a database). But the implications are simple: <em>Improve the thing that will <strong>actually</strong> help.</em></p>
<p>As programmers, however, we would rather contemplate just what is <a href="http://www.codinghorror.com/blog/2009/01/the-sad-tragedy-of-micro-optimization-theater.html" target="_blank">the fastest way to concatenate a string</a>. Or whether <a class="zem_slink" title="PHP" href="http://www.php.net" rel="homepage" target="_blank">PHP</a> is much faster than Ruby. And just how much more traffic you can handle with 5 or 10 fcgi workers. And so on. The internet is riddled with these questions. And let&#8217;s not forget the age old debate of speed improvements by using raw <a class="zem_slink" title="SQL" href="http://www.iso.org/iso/catalogue_detail.htm?csnumber=45498" rel="homepage" target="_blank">SQL</a> instead of an <a class="zem_slink" title="Object-relational mapping" href="http://en.wikipedia.org/wiki/Object-relational_mapping" rel="wikipedia" target="_blank">ORM</a>.</p>
<p>Once upon a time I even wrote a web framework where I made sure to <em>always use the fastest pattern of doing X in PHP</em>. I knew databases were slow, so I did a lot of the work regarding JOINs and such in PHP.</p>
<p>Yeah.</p>
<h2>Optimizing where it matters</h2>
<p>The other day I finally assembled all the bits and pieces for an <a class="zem_slink" title="Evolutionary algorithm" href="http://en.wikipedia.org/wiki/Evolutionary_algorithm" rel="wikipedia" target="_blank">evolutionary algorithm</a> in <a class="zem_slink" title="Haskell (programming language)" href="http://haskell.org" rel="homepage" target="_blank">Haskell</a>.</p>
<p>I&#8217;m trying to print <em><a class="zem_slink" title="Hello world program" href="http://en.wikipedia.org/wiki/Hello_world_program" rel="wikipedia" target="_blank">Hello World</a></em> by performing random changes on a population of strings &#8211; eventually I want to create an extensible framework for evolutionary algorithms that will let me <a href="http://swizec.github.com/Le-Thesis/" target="_blank">write poetry programmatically</a>.</p>
<p>It took <strong>27 seconds</strong> to go 5 epochs. Just five generations.</p>
<pre lang="log">  INIT    time    0.00s  (  0.00s elapsed)
  MUT     time   26.47s  ( 27.00s elapsed)
  GC      time    0.62s  (  0.62s elapsed)
  EXIT    time    0.00s  (  0.00s elapsed)
  Total   time   27.08s  ( 27.62s elapsed)

  %GC     time       2.3%  (2.2% elapsed)

  Productivity  97.7% of total user, 95.8% of total elapsed</pre>
<p>Okay, it&#8217;s definitely not a problem with memory access. 97.7% of the time is spent in computation, this is good, but slightly worrying. Let&#8217;s do some profiling!</p>
<pre lang="log">COST CENTRE   MODULE           %time %alloc

levenshtein   Evaluators.Basic  91.5  100.0
levenshtein.d Evaluators.Basic   8.5    0.0</pre>
<p>The <a title="Levenshtein distance in Haskell" href="http://swizec.com/blog/levenshtein-distance-in-haskell/swizec/4801" target="_blank">levenshtein distance function I implemented</a> costs 100% of <a class="zem_slink" title="Time complexity" href="http://en.wikipedia.org/wiki/Time_complexity" rel="wikipedia" target="_blank">computation time</a>!</p>
<p>After replacing my function with <a href="http://www.reddit.com/r/programming/comments/w4gs6/levenshtein_distance_in_haskell/c5a6jjz" target="_blank">the implementation suggested by Reddit</a> life instantly became much easier. It now takes just 0.03 seconds to compute 5 epochs of the algorithm.</p>
<p><strong>27 seconds -&gt; 0.03 seconds by changing a single function.</strong></p>
<p>The problem I have now is anything larger than ~25 epochs makes my computer decide something funny is going and kill the program, which says I&#8217;m doing something terrible with memory.</p>
<p>Then again, there <em>are</em> 480195 population members at the 25th epoch &#8230; I probably don&#8217;t need that many.</p>
<p>By the way, it&#8217;s still not a memory problem per se (for 20 epochs):</p>
<pre lang="log">  Total   time   10.72s  ( 10.80s elapsed)

  %GC     time      23.4%  (23.3% elapsed)

  Alloc rate    2,736,341,212 bytes per MUT second

  Productivity  76.6% of total user, 76.0% of total elapsed

-----

COST CENTRE    MODULE           %time %alloc

lev'''.lev     Evaluators.Basic  61.5   58.8
lev'''.levMemo Evaluators.Basic  17.3   31.4
breedTwo       Operators.Basic    2.8    2.4
breedTwo.(...) Operators.Basic    2.0    0.6
breedTwo.(...) Operators.Basic    1.3    0.6
breedTwo.(...) Operators.Basic    1.3    0.6
select.\       Selectors.Basic    1.1    0.3
lev'''.xa      Evaluators.Basic   1.1    0.6</pre>
<h6 class="zemanta-related-title" style="font-size: 1em;">Related articles</h6>
<ul class="zemanta-article-ul zemanta-article-ul-image" style="margin: 0; padding: 0; overflow: hidden;">
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://swizec.com/blog/levenshtein-distance-in-haskell/swizec/4801" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/98768579_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://swizec.com/blog/levenshtein-distance-in-haskell/swizec/4801" target="_blank">Levenshtein distance in Haskell</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://blog.pdark.de/2012/06/29/jazoon-2012-divideconquer-efficient-java-for-multicore-world/" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/97318522_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://blog.pdark.de/2012/06/29/jazoon-2012-divideconquer-efficient-java-for-multicore-world/" target="_blank">Jazoon 2012: Divide&amp;Conquer: Efficient Java for Multicore World</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://swizec.com/blog/an-elegant-way-to-randomly-change-every-list-member-in-haskell/swizec/5060" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/106367996_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://swizec.com/blog/an-elegant-way-to-randomly-change-every-list-member-in-haskell/swizec/5060" target="_blank">An elegant way to randomly change every list member in Haskell</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://blog.kejser.org/2012/07/16/how-vertical-partitioning-and-deep-joins-kill-parallelism/" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/100761108_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://blog.kejser.org/2012/07/16/how-vertical-partitioning-and-deep-joins-kill-parallelism/" target="_blank">How Vertical Partitioning and Deep Joins Kill Parallelism</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://plumbr.eu/blog/let-them-talk" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/97839111_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://plumbr.eu/blog/let-them-talk" target="_blank">Let them talk</a></li>
<li class="zemanta-article-ul-li-image zemanta-article-ul-li" style="padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;"><a style="box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;" href="http://blog.codecentric.de/en/2012/07/10-application-performance-tuning-tips/" target="_blank"><img style="padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;" src="http://i.zemanta.com/noimg_116_80_80.jpg" alt="" /></a><a style="display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;" href="http://blog.codecentric.de/en/2012/07/10-application-performance-tuning-tips/" target="_blank">10 Application Performance Tuning Tips</a></li>
</ul>
<div class="zemanta-pixie" style="margin-top: 10px; height: 15px;"><a class="zemanta-pixie-a" title="Enhanced by Zemanta" href="http://www.zemanta.com/?px"><img class="zemanta-pixie-img" style="border: none; float: right;" src="http://img.zemanta.com/zemified_e.png?x-id=0ef6e9d4-09b7-4153-a0af-d9a65c1facb9" alt="Enhanced by Zemanta" /></a></div>
</div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-post-js","jsonName":"post-amdahls-law-in-action-27-s-to-0-03-s-by-changing-a-function-bf9","path":"/post/amdahls-law-in-action-27s-to-0-03s-by-changing-a-function/"};window.dataPath="305/path---post-amdahls-law-in-action-27-s-to-0-03-s-by-changing-a-function-bf-9-656-rUf5Sd6h0jJZKbTVNe7GDKMwp4o";/*]]>*/</script><script src="/swizecblog/webpack-runtime-5246e3ca1a8c4f82e8dd.js" async=""></script><script src="/swizecblog/app-8e5a12ea225b4ed6ef6a.js" async=""></script><script src="/swizecblog/0-ed8d8080a34ece5ef8f5.js" async=""></script><script src="/swizecblog/component---src-components-post-js-9d5fb6538e5aeddeb728.js" async=""></script></body></html>