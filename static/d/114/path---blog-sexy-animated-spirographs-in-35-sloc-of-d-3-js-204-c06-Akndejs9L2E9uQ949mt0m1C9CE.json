{"data":{"wordpressPost":{"title":"Sexy animated spirographs in 35 sloc of d3.js","content":"<p>You probably remember spirographs as kid&#8217;s toys from your youth. I had a simple set that was just a collection of plastic sprockets with holes for pencils.</p>\n<p>Endless amounts of fun when I was two or three years old. I think &#8230; I don&#8217;t really remember much from that time, but I remember having those thingies and loving playing with them. One of my earliest memories even!</p>\n<div style=\"width: 570px\" class=\"wp-caption alignnone\"><img class=\" \" title=\"Spirograph\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/9/97/Spirograph3.jpg/800px-Spirograph3.jpg\" alt=\"Spirograph\" width=\"560\" height=\"420\" /><p class=\"wp-caption-text\"><a class=\"zem_slink\" title=\"Spirograph\" href=\"http://en.wikipedia.org/wiki/Spirograph\" rel=\"wikipedia\" target=\"_blank\">Spirograph</a></p></div>\n<p>Last night I was making an animation example for the d3.js book I&#8217;m writing and ended up with the idea of progressively drawing out cool looking parametric equations. Little did I know, those are actually spirographs! Learned something while I was learning something.</p>\n<blockquote class=\"twitter-tweet\"><p>@<a href=\"https://twitter.com/swizec\">swizec</a> <a class=\"zem_slink\" title=\"Parametric equation\" href=\"http://en.wikipedia.org/wiki/Parametric_equation\" rel=\"wikipedia\" target=\"_blank\">Parametric equations</a> are a way to model physical spirographs. <a title=\"http://en.wikipedia.org/wiki/Spirograph\" href=\"http://t.co/JvFBin6ZGa\">en.wikipedia.org/wiki/Spirograph</a></p>\n<p>— Klemen Slavič (@krofdrakula) <a href=\"https://twitter.com/krofdrakula/status/309348085983756288\">March 6, 2013</a></p></blockquote>\n<p>My failure in common knowledge aside, it&#8217;s possible to animate the drawing of parametric equations with just a few lines of <a href=\"http://d3js.org\" target=\"_blank\">d3.js</a> code. What I&#8217;m about to show you has a pretty big problem, but produces cool looking results &#8220;in the lab&#8221;. Try to guess what the problem is.</p>\n<h2>Animating spirographs</h2>\n<div id=\"attachment_6059\" style=\"width: 496px\" class=\"wp-caption alignnone\"><a href=\"http://swizec.com/blog/wp-content/uploads/2013/03/0007_04_04.png\"><img class=\" wp-image-6059 \" title=\"After a few steps\" src=\"http://swizec.com/blog/wp-content/uploads/2013/03/0007_04_04.png\" alt=\"After a few steps\" width=\"486\" height=\"354\" srcset=\"https://swizec.com/blog/wp-content/uploads/2013/03/0007_04_04.png 607w, https://swizec.com/blog/wp-content/uploads/2013/03/0007_04_04-300x218.png 300w\" sizes=\"(max-width: 486px) 100vw, 486px\" /></a><p class=\"wp-caption-text\">After a few steps</p></div>\n<p>We&#8217;ll make an animation timer and for each tick we&#8217;ll draw a new step of the spirograph. After the spirograph is finished, we&#8217;ll stop the timer. To make the animation more interesting to watch, we&#8217;ll also fake a brush flying around (just a black dot).</p>\n<p>We start with some basic html:</p>\n<pre lang=\"html\">\r\n<!DOCTYPE html>\r\n<title></title>\r\n<link href=\"../bootstrap/css/bootstrap.min.css\" rel=\"stylesheet\">\r\n\r\n<div id=\"graph\"></div>\r\n\r\n<script src=\"http://d3js.org/d3.v3.min.js\"></script>\r\n<script src=\"timers.js\"></script>\r\n</pre>\n<p>Then we hop into the javascript to flesh out the actual code.</p>\n<pre lang=\"javascript\">var width = 600,\r\n    height = 600,\r\n    svg = d3.select('#graph')\r\n        .append('svg')\r\n        .attr({width: width,\r\n               height: height});</pre>\n<p>I found the parametric function in the wikipedia&#8217;s article on parametric equations. We&#8217;ll be giving it a simple parameter calculated from the animation timer and it will return a two dimensional position.</p>\n<pre lang=\"javascript\">var position = function (t) {\r\n    var a = 80, b = 1, c = 1, d = 80;\r\n\r\n    return {x: Math.cos(a*t) - Math.pow(Math.cos(b*t), 3),\r\n            y: Math.sin(c*t) - Math.pow(Math.sin(d*t), 3)};\r\n};</pre>\n<p>Tweaking the <em>a</em>, <em>b</em>, c, and <em>d</em> parameters will change the final shape.</p>\n<p>Next we&#8217;re going to define some scales to help us translate between maths space and our drawing space.</p>\n<pre lang=\"javascript\">var t_scale = d3.scale.linear().domain([500, 30000]).range([0, 2*Math.PI]),\r\n    x = d3.scale.linear().domain([-2, 2]).range([100, width-100]),\r\n    y = d3.scale.linear().domain([-2, 2]).range([height-100, 100]);\r\n\r\nvar brush = svg.append('circle')\r\n        .attr({r: 4}),\r\n    previous = position(0);</pre>\n<p>The <em>t_scale</em> is going to translate time into a parameter, <em>x</em> and <em>y</em> calculate proper positions on the final image using the coordinates returned by the position function.</p>\n<p>We also put a simple circle on the image &#8211; this will represent the brush &#8211; and we need to take note of the previous position so we can draw lines between our current and previous state.</p>\n<pre lang=\"javascript\">var step = function (time) {\r\n    if (time > t_scale.domain()[1]) {\r\n        return true;\r\n    }\r\n\r\n    var t = t_scale(time),\r\n        pos = position(t);\r\n\r\n    brush.attr({cx: x(pos.x),\r\n                cy: y(pos.y)});\r\n    svg.append('line')\r\n        .attr({x1: x(previous.x),\r\n               y1: y(previous.y),\r\n               x2: x(pos.x),\r\n               y2: y(pos.y),\r\n               stroke: 'steelblue',\r\n               'stroke-width': 1.3});\r\n\r\n    previous = pos;\r\n};</pre>\n<p>This is our <a class=\"zem_slink\" title=\"Step function\" href=\"http://en.wikipedia.org/wiki/Step_function\" rel=\"wikipedia\" target=\"_blank\">step function</a>. It draws every consecutive step of the animation by moving the brush and putting a line between the current and previous position. The animation will stop when this function returns <em>true</em> so we make sure the <em>time</em> parameter doesn&#8217;t go beyond <em>t_scales</em>&#8216;s domain.</p>\n<p>Finally, we simply start the timer.</p>\n<pre lang=\"javascript\">var timer = d3.timer(step, 500);</pre>\n<p>The timer will start running after 500 milliseconds and repeatedly call the <em>step </em>function until it returns <em>true.</em></p>\n<p>You can check the animation out via <a href=\"http://swizec.github.com/d3.js-book-examples/ch4/timers.html\" target=\"_blank\">the magic of github pages</a>. The final spirograph looks like this:</p>\n<div id=\"attachment_6055\" style=\"width: 565px\" class=\"wp-caption alignnone\"><a href=\"http://swizec.com/blog/wp-content/uploads/2013/03/0007_04_05.png\"><img class=\"size-full wp-image-6055\" title=\"A parametric equation visualised\" src=\"http://swizec.com/blog/wp-content/uploads/2013/03/0007_04_05.png\" alt=\"A parametric equation visualised\" width=\"555\" height=\"443\" srcset=\"https://swizec.com/blog/wp-content/uploads/2013/03/0007_04_05.png 555w, https://swizec.com/blog/wp-content/uploads/2013/03/0007_04_05-300x239.png 300w\" sizes=\"(max-width: 555px) 100vw, 555px\" /></a><p class=\"wp-caption-text\">A parametric equation visualised</p></div>\n<p>Figured out the problem yet?</p>\n<p>The problem with this approach is that I&#8217;m using the animation timer itself as a parameter to the function, which means point density depends on how long you&#8217;re willing to let the animation run. It will always draw the complete function because of how d3 scales work, but it might look <em>very</em> approximate. Think squares for circles approximate.</p>\n<p>Another problem is that using a slower computer, or doing anything that lags the CPU even a little bit while the animation is running will ruin the final picture.</p>\n<p>For instance, this is what happens when I switch desktops around while the browser is drawing.</p>\n<div id=\"attachment_6057\" style=\"width: 556px\" class=\"wp-caption alignnone\"><a href=\"http://swizec.com/blog/wp-content/uploads/2013/03/glitchy-spirograph.png\"><img class=\" wp-image-6057 \" title=\"Glitchy spirograph\" src=\"http://swizec.com/blog/wp-content/uploads/2013/03/glitchy-spirograph.png\" alt=\"Glitchy spirograph\" width=\"546\" height=\"534\" srcset=\"https://swizec.com/blog/wp-content/uploads/2013/03/glitchy-spirograph.png 910w, https://swizec.com/blog/wp-content/uploads/2013/03/glitchy-spirograph-300x293.png 300w\" sizes=\"(max-width: 546px) 100vw, 546px\" /></a><p class=\"wp-caption-text\">Glitchy spirograph</p></div>\n<p>&nbsp;</p>\n<h6 class=\"zemanta-related-title\" style=\"font-size: 1em;\">Related articles</h6>\n<ul class=\"zemanta-article-ul zemanta-article-ul-image\" style=\"margin: 0; padding: 0; overflow: hidden;\">\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://www.universetoday.com/100325/the-vela-pulsar-as-a-spirograph/\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/148486923_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://www.universetoday.com/100325/the-vela-pulsar-as-a-spirograph/\" target=\"_blank\">The Vela Pulsar as a Spirograph</a></li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://hackaday.com/2013/02/21/laser-spirograph/\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/147121686_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://hackaday.com/2013/02/21/laser-spirograph/\" target=\"_blank\">Laser Spirograph</a></li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://www.gizmodo.co.uk/2013/02/watch-the-universe-draw-an-awesome-spirograph-in-the-sky/\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/148806266_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://www.gizmodo.co.uk/2013/02/watch-the-universe-draw-an-awesome-spirograph-in-the-sky/\" target=\"_blank\">Watch the Universe Draw an Awesome Spirograph in the Sky</a></li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://phys.org/news/2013-02-fermi-motion-spirograph.html\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/148576796_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://phys.org/news/2013-02-fermi-motion-spirograph.html\" target=\"_blank\">Fermi&#8217;s motion produces a study in spirograph</a></li>\n</ul>\n<div class=\"zemanta-pixie\" style=\"margin-top: 10px; height: 15px;\"><a class=\"zemanta-pixie-a\" title=\"Enhanced by Zemanta\" href=\"http://www.zemanta.com/?px\"><img class=\"zemanta-pixie-img\" style=\"border: none; float: right;\" src=\"http://img.zemanta.com/zemified_e.png?x-id=fb22a411-7098-4367-b54c-e6363f006ad9\" alt=\"Enhanced by Zemanta\" /></a></div>\n"},"site":{"siteMetadata":{"title":"Swizec Blog","subtitle":"Fetch Data From Local WP Install"}}},"pageContext":{"id":"6f843b1e-7d7f-5c46-9749-991b0d06750a"}}