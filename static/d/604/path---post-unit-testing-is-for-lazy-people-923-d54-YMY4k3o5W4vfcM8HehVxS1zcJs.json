{"data":{"wordpressPost":{"title":"Unit testing is for lazy people","content":"<p>The other day I was talking to a guy about a possible freelancing gig and he said how wonderful it was that I should bring up the topic of unit/<a class=\"zem_slink\" title=\"Test automation\" href=\"http://en.wikipedia.org/wiki/Test_automation\" rel=\"wikipedia\">automated testing</a>without being asked. Said that most (many?) developers don&#8217;t have the level of rigor to use automated testing.</p>\n<div id=\"attachment_3790\" style=\"width: 373px\" class=\"wp-caption alignright\"><a href=\"http://swizec.com/blog/wp-content/uploads/2012/02/fallen-building.jpg\"><img class=\" wp-image-3790 \" title=\"Oops building\" src=\"http://swizec.com/blog/wp-content/uploads/2012/02/fallen-building.jpg\" alt=\"Oops building\" width=\"363\" height=\"246\" srcset=\"https://swizec.com/blog/wp-content/uploads/2012/02/fallen-building.jpg 519w, https://swizec.com/blog/wp-content/uploads/2012/02/fallen-building-300x202.jpg 300w\" sizes=\"(max-width: 363px) 100vw, 363px\" /></a><p class=\"wp-caption-text\">Oops building</p></div>\n<p>My reaction was one of disbelief <em>&#8220;Rigor!? But automated testing is one of the laziest things a developer can do! It speeds stuff up </em>so<em> much!&#8221;</em></p>\n<p>As luck would have it, last night I was hit over the head with my own words and nearly died <a class=\"zem_slink\" title=\"Debugging\" href=\"http://en.wikipedia.org/wiki/Debugging\" rel=\"wikipedia\">debugging</a> a single function.</p>\n<p>I was working on Stripe webhooks and for security reasons decided not to use the event data sent in request body. Makes sense right? Take the event id from request body, then fetch the actual event from Stripe.</p>\n<p>It&#8217;s the only way to be certain you aren&#8217;t responding to bogus events sent by an evil person trying to make you look bad (nothing <em>actually</em> bad can happen, at worst a customer would get extra paid invoice emails).</p>\n<p>Due to poor decoupling &#8211; I didn&#8217;t really want to decouple a 6 line function into two functions &#8211; everything was now difficult to test. I can&#8217;t create events on Stripe&#8217;s servers with <a class=\"zem_slink\" title=\"Unit testing\" href=\"http://en.wikipedia.org/wiki/Unit_testing\" rel=\"wikipedia\">unit tests</a> and without actual events existing I can&#8217;t test the function works as it&#8217;s supposed to.</p>\n<p>How many bugs can you put in a 6 line function anyway?</p>\n<h2>A lot of bugs!</h2>\n<p>When the client tested on staging &#8230; it didn&#8217;t work. Invoice email wasn&#8217;t sent and Stripe complained of a <a class=\"zem_slink\" title=\"List of HTTP status codes\" href=\"http://en.wikipedia.org/wiki/List_of_HTTP_status_codes\" rel=\"wikipedia\">500 error</a>.</p>\n<div style=\"width: 310px\" class=\"wp-caption alignright\"><a href=\"http://commons.wikipedia.org/wiki/File:Army_Camp-sml.JPG\"><img class=\"zemanta-img-inserted zemanta-img-configured\" title=\"English: British Army Signals Trials Unit test...\" src=\"http://swizec.com/blog/wp-content/uploads/2012/02/300px-Army_Camp-sml.jpg\" alt=\"English: British Army Signals Trials Unit test...\" width=\"300\" height=\"221\" /></a><p class=\"wp-caption-text\">Image via Wikipedia</p></div>\n<p>It took me almost two hours to fix all the bugs because my testing cycle looked like this:</p>\n<ol>\n<li>change code</li>\n<li>commit to <em>develop branch</em></li>\n<li>switch to <em>staging branch</em></li>\n<li>merge develop branch into staging</li>\n<li>push to github</li>\n<li>change to other terminal window</li>\n<li>pull from staging branch</li>\n<li>restart python processes</li>\n<li>go to Stripe dashboard</li>\n<li>pick customer</li>\n<li>create invoice item</li>\n<li>create actual invoice</li>\n<li>choose invoice</li>\n<li><em>pay</em> invoice</li>\n<li>go to Stripe logs</li>\n<li>find <em>invoice.payment_succeeded</em> webhook</li>\n<li>scroll down to response</li>\n<li>look through raw html of django&#8217;s error page</li>\n<li>find symptom</li>\n<li>GOTO 1.</li>\n</ol>\n<p>That&#8217;s right, a whopping <em>20 step</em> debug cycle all because I&#8217;m an idiot and couldn&#8217;t find a way to automate this. Or maybe I was too tired to do the unobvious thing &#8230; although I still don&#8217;t want to split a 6 liner into two functions.</p>\n<p>With proper <a class=\"zem_slink\" title=\"Unit testing\" href=\"http://en.wikipedia.org/wiki/Unit_testing\" rel=\"wikipedia\">unit testing</a> the debug cycle would look like this:</p>\n<ol>\n<li>change code</li>\n<li>run tests</li>\n<li>symptom thrown in face</li>\n<li>GOTO 1.</li>\n</ol>\n<p>Much lazier right?</p>\n<p>For the record, those six lines of code contained <strong>4</strong> bugs -&gt;</p>\n<ul>\n<li>forgot to import a module</li>\n<li>different event data structure than I understood from the docs</li>\n<li>twice^</li>\n<li>misnamed variables from one line to another</li>\n</ul>\n<p>Yes, all of those could <em>easily</em> have been caught if my <a class=\"zem_slink\" title=\"Fault coverage\" href=\"http://en.wikipedia.org/wiki/Fault_coverage\" rel=\"wikipedia\">test coverage</a> was actually any good! And then not only would I not look like an idiot in front of the client, I&#8217;d probably spend no more than ten minutes fixing this.</p>\n<p>Let this be a lesson both to you and to Future Swizec!</p>\n<h6 class=\"zemanta-related-title\" style=\"font-size: 1em;\">Related articles</h6>\n<ul class=\"zemanta-article-ul\">\n<li class=\"zemanta-article-ul-li\"><a href=\"http://stackoverflow.com/questions/9418892/easymock-times-behaviour-not-being-checked-for-strict-mock\">EasyMock: Times behaviour not being checked for strict mock</a> (stackoverflow.com)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://stackoverflow.com/questions/8719147/how-do-continuous-integration-and-automated-tests-look-in-practice\">How does continuous integration and automated tests look in practice?</a> (stackoverflow.com)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://autismjungle.wordpress.com/2012/02/26/change-of-plan/\">Change of Plan</a> (autismjungle.wordpress.com)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://www.makinggoodsoftware.com/2012/01/27/the-evil-unit-test/\">The evil unit test.</a> (makinggoodsoftware.com)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://kimphanvn.wordpress.com/2012/02/27/test-driven-development-best-practices-and-benefits-of-using-unit-testing-on-real-life-projects/\">Test Driven Development: Best Practices and Benefits of Using Unit Testing on Real Life Projects</a> (kimphanvn.wordpress.com)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://mallibone.wordpress.com/2012/02/14/run-your-tests-with-a-single-command/\">Run your all your tests with rake</a> (mallibone.wordpress.com)</li>\n<li class=\"zemanta-article-ul-li\"><a href=\"http://www.slideshare.net/gilzilberfeld/introduction-to-unit-testing-10983708\">Introduction to unit testing</a> (slideshare.net)</li>\n</ul>\n<div class=\"zemanta-pixie\" style=\"margin-top: 10px; height: 15px;\"><a class=\"zemanta-pixie-a\" title=\"Enhanced by Zemanta\" href=\"http://www.zemanta.com/\"><img class=\"zemanta-pixie-img\" style=\"border: none; float: right;\" src=\"http://img.zemanta.com/zemified_e.png?x-id=140931a7-b24e-4c17-95ae-a9e183cc803b\" alt=\"Enhanced by Zemanta\" /></a></div>\n"},"site":{"siteMetadata":{"title":"Swizec Blog","subtitle":"Fetch Data From Local WP Install"}}},"pageContext":{"id":"c13541d4-42a4-5b5f-8c35-f20909e1d3e8"}}