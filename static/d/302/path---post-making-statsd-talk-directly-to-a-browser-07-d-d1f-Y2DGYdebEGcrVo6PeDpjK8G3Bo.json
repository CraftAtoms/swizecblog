{"data":{"wordpressPost":{"title":"Making statsd talk directly to a browser","content":"<p><a href=\"https://github.com/etsy/statsd\" target=\"_blank\">StatsD</a> is &#8220;<em>A network daemon that runs on the <a href=\"http://nodejs.org/\">Node.js</a> platform and listens for statistics, like counters and timers, sent over <a href=\"http://en.wikipedia.org/wiki/User_Datagram_Protocol\">UDP</a> and sends aggregates to one or more pluggable backend services&#8221;</em></p>\n<p>I&#8217;ve previously mentioned StatsD in <em><a href=\"http://www.zemanta.com/fruitblog/your-startup-needs-a-dashboard/\" target=\"_blank\">Your startup needs a dashboard</a></em> over at Zemanta&#8217;s fruitblog.</p>\n<p>The idea behind StatsD is this:</p>\n<ol>\n<li>Stuff happens</li>\n<li>Send metrics of &#8220;stuff&#8221; to a central service (StatsD)</li>\n<li>StatsD acts as a buffer, forwards aggregated metrics every X seconds</li>\n</ol>\n<p>Your architecture now has a central service that collects all of your metrics, then pushes them to appropriate software, that doesn&#8217;t need to handle too much traffic and is guaranteed data will come from a single source in a sanitized format.</p>\n<div style=\"width: 377px\" class=\"wp-caption alignnone\"><img class=\" \" title=\"A software architect's dream\" src=\"http://distilleryimage0.instagram.com/1d60c314b6de11e1a9f71231382044a1_7.jpg\" alt=\"A software architect's dream\" width=\"367\" height=\"367\" /><p class=\"wp-caption-text\">A software architect&#39;s dream</p></div>\n<h2>Straight from the browser?</h2>\n<p>Collecting data into StatsD works wonderfully. It&#8217;s fast, reliable, extremely robust and you can give it just about any data you can think of.</p>\n<p>Unless your client is a browser.</p>\n<p>See, StatsD only accepts UDP packets and browsers don&#8217;t let you send UDP packets. There&#8217;s a valid excuse for this &#8211; it doesn&#8217;t matter if some packets are lost, as long as whatever you&#8217;re measuring isn&#8217;t slowed down by the measuring.</p>\n<p>To solve this I created a simple proxy in node.js. It accepts normal HTTP requests and pushes data onward to StatsD. The simplicity, I hope, ensures speed.</p>\n<p>The API is a simple tracking pixel:</p>\n<pre lang=\"html\">\r\n<img src=\"http://<address>?t=<type>&v=<value>&b=<bucket>\" />\r\n</pre>\n<p>Where <em>type</em> is one of <em>c </em>(counter)<em>, t </em>(timer)<em>, g </em>(gauge)<em>.</em> As per StatsD naming convention. And <em>bucket</em> is simply the name of your metric.</p>\n<p><a href=\"https://github.com/Swizec/personal-dashboard/blob/master/collectors/js_proxy/server.js\" target=\"_blank\">The source</a> is on github. Feel free to use it.</p>\n<h2>Straight to the browser</h2>\n<p>Ok, so now we can collect data from the browser &#8230; but I want to send it directly to a browser as well. None of that <a href=\"http://graphite.wikidot.com/\" target=\"_blank\">Graphite</a> stuff &#8211; I want to use some other fancy graphs and visualisations. Just because.</p>\n<p>To solve this problem I implemented a socket.io backend for StatsD. It, also, can be found on github -&gt; <a href=\"https://github.com/etsy/statsd/pull/102\">https://github.com/etsy/statsd/pull/102</a></p>\n<p>Hope the pull request gets merged soon, or at all for that matter. I really think this is a useful addition to StatsD because it means you can use whatever client-side javascript to do visualisations. In near real-time and all that.</p>\n<p>The data is sent over in a simple format:</p>\n<pre lang=\"javascript\">\r\n{perSecond: {bucket1: 0.2,\r\n             bucket2: 0.1\r\n             },\r\n counts: {bucket1: 2,\r\n          bucket2: 1\r\n         },\r\n timers: {timer1: {upper: 2.4,\r\n                   lower: 1.2,\r\n                   count: 10}\r\n         },\r\n gauges: {gauge1: 10\r\n          },\r\n statsd: {numStats: 6},\r\n timestamp: <unix timestamp>}\r\n</pre>\n<h2>The goal?</h2>\n<p>If all goes well, I will soon be able to use cubism.js to draw a pretty timeseries of the traffic on this blog. And hey, who knows what else I can think of to add to a personal dashboard of my life &#8230; I now have the basic framework. Time to start using it.</p>\n<a href=\"http://square.github.com/cubism/\"><img src=\"http://swizec.com/blog/wp-content/uploads/2012/06/cubismjs-shiny-timeseries.png\" alt=\"Cubism.js makes shiny timeseries\" title=\"Cubism.js makes shiny timeseries\" width=\"959\" height=\"314\" class=\"alignnone size-full wp-image-4657\" srcset=\"https://swizec.com/blog/wp-content/uploads/2012/06/cubismjs-shiny-timeseries.png 959w, https://swizec.com/blog/wp-content/uploads/2012/06/cubismjs-shiny-timeseries-300x98.png 300w\" sizes=\"(max-width: 959px) 100vw, 959px\" /></a>\n<h6 class=\"zemanta-related-title\" style=\"font-size: 1em;\">Related articles</h6>\n<ul class=\"zemanta-article-ul zemanta-article-ul-image\" style=\"margin-left: 0; display: inline-block; list-style-type: none;\">\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;\"><a href=\"http://www.zemanta.com/fruitblog/your-startup-needs-a-dashboard/\" target=\"_blank\"><img style=\"padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;\" src=\"http://i.zemanta.com/92004102_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;\" href=\"http://www.zemanta.com/fruitblog/your-startup-needs-a-dashboard/\" target=\"_blank\">Your startup needs a dashboard</a>\n<div style=\"clear: both; margin: 10px 0 10px 0;\">\n<hr style=\"margin: 0;\" />\n</div>\n</li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;\"><a href=\"http://www.slideshare.net/quipo/scalable-architectures-taming-the-twitter-firehose\" target=\"_blank\"><img style=\"padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;\" src=\"http://i.zemanta.com/89469802_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;\" href=\"http://www.slideshare.net/quipo/scalable-architectures-taming-the-twitter-firehose\" target=\"_blank\">Scalable Architectures &#8211; Taming the Twitter Firehose</a>\n<div style=\"clear: both; margin: 10px 0 10px 0;\">\n<hr style=\"margin: 0;\" />\n</div>\n</li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;\"><a href=\"http://oubiwann.blogspot.com/2011/06/txstatsd-preview.html\" target=\"_blank\"><img style=\"padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;\" src=\"http://i.zemanta.com/noimg_18_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;\" href=\"http://oubiwann.blogspot.com/2011/06/txstatsd-preview.html\" target=\"_blank\">txStatsD Preview</a>\n<div style=\"clear: both; margin: 10px 0 10px 0;\">\n<hr style=\"margin: 0;\" />\n</div>\n</li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;\"><a href=\"http://blog.artillerygames.com/2012/06/websocket-performance.html\" target=\"_blank\"><img style=\"padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;\" src=\"http://i.zemanta.com/noimg_03_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;\" href=\"http://blog.artillerygames.com/2012/06/websocket-performance.html\" target=\"_blank\">Experiments with WebSocket Performance (for HTML5 games)</a>\n<div style=\"clear: both; margin: 10px 0 10px 0;\">\n<hr style=\"margin: 0;\" />\n</div>\n</li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;\"><a href=\"http://obfuscurity.com/2012/05/A-Foolishly-Sensible-Proposal-for-Graphite\" target=\"_blank\"><img style=\"padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;\" src=\"http://i.zemanta.com/noimg_17_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;\" href=\"http://obfuscurity.com/2012/05/A-Foolishly-Sensible-Proposal-for-Graphite\" target=\"_blank\">A Foolishly Sensible Proposal for Graphite</a>\n<div style=\"clear: both; margin: 10px 0 10px 0;\">\n<hr style=\"margin: 0;\" />\n</div>\n</li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"display: inline-block; vertical-align: top; text-align: left; font-size: 12px; width: 80px; height: 240px; margin: 10px 40px 20px 0px; zoom: 1; *display: inline;\"><a href=\"http://37signals.com/svn/posts/3185-link-our-implementation-of-statsd\" target=\"_blank\"><img style=\"padding: 0; margin: 0 10px 10px 0; border: 0; display: block; box-shadow: 1px 1px 3px #999;\" src=\"http://i.zemanta.com/91655784_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; width: 80px; height: 90px; overflow: hidden; text-decoration: none; line-height: 14pt;\" href=\"http://37signals.com/svn/posts/3185-link-our-implementation-of-statsd\" target=\"_blank\">LINK: Our implementation of Statsd</a>\n<div style=\"clear: both; margin: 10px 0 10px 0;\">\n<hr style=\"margin: 0;\" />\n</div>\n</li>\n</ul>\n<div class=\"zemanta-pixie\" style=\"margin-top: 10px; height: 15px;\"><a class=\"zemanta-pixie-a\" title=\"Enhanced by Zemanta\" href=\"http://www.zemanta.com/?px\"><img class=\"zemanta-pixie-img\" style=\"border: none; float: right;\" src=\"http://img.zemanta.com/zemified_e.png?x-id=4eaa9d08-7860-4eca-9d2d-eb7b8dad4f21\" alt=\"Enhanced by Zemanta\" /></a></div>\n"},"site":{"siteMetadata":{"title":"Swizec Blog","subtitle":"Fetch Data From Local WP Install"}}},"pageContext":{"id":"9df96d6e-58f2-5aa7-987a-c82a3ad01fbd"}}