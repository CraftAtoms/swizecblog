{"data":{"wordpressPost":{"title":"Testing Backbone apps with Mocha","content":"<a href=\"http://swizec.com/blog/wp-content/uploads/2012/12/Selection_090.png\"><img class=\"alignright size-full wp-image-5790\" title=\"A test bed\" src=\"http://swizec.com/blog/wp-content/uploads/2012/12/Selection_090.png\" alt=\"A test bed\" width=\"713\" height=\"358\" srcset=\"https://swizec.com/blog/wp-content/uploads/2012/12/Selection_090.png 713w, https://swizec.com/blog/wp-content/uploads/2012/12/Selection_090-300x150.png 300w\" sizes=\"(max-width: 713px) 100vw, 713px\" /></a>\n<p>A while ago I decided it was finally time to bite the bullet and learn frontend <a class=\"zem_slink\" title=\"Software testing\" href=\"http://en.wikipedia.org/wiki/Software_testing\" rel=\"wikipedia\" target=\"_blank\">testing</a>. Things were getting out of hand with a project I&#8217;m working on (<a href=\"http://melt.ee\" target=\"_blank\">melt.ee</a>) and I could no longer keep a good development pace while ensuring a good level of quality.</p>\n<p>You know the drill, it&#8217;s just a three page app. Then <a class=\"zem_slink\" title=\"Corner case\" href=\"http://en.wikipedia.org/wiki/Corner_case\" rel=\"wikipedia\" target=\"_blank\">corner cases</a> in UX start cropping up and suddenly it&#8217;s a 7 page app whose state machine covers a conference room whiteboard. Suddenly your approach produces three bugs for every one you fix and the thought of adding features gives you nightmares.</p>\n<p>Time for a refactor!</p>\n<p>And a brilliant opportunity to introduce some tests.</p>\n<h2>Mocha frontend testing</h2>\n<p>Looking far and wide for a nice tool to use I finally settled on <a href=\"http://mochajs.com\" target=\"_blank\">Mocha</a> because it&#8217;s the same set of tools I use for testing node.js servers. Selenium still feels kind of weird to me and although <a href=\"http://casperjs.org/\" target=\"_blank\">Casper.js</a> looks awesome I had a hard time figuring out how to begin using it, plus it didn&#8217;t feel like the perfect fit.</p>\n<p><iframe src=\"http://www.youtube.com/embed/zvvUN2L5UnA\" frameborder=\"0\" width=\"420\" height=\"315\"></iframe></p>\n<p>Mocha is a pure javascript test runner that simply lets you run some javascript code. That&#8217;s it. Because I was testing a Backbone.js app it was the best fit &#8211; all I really have to do is run some of my production code and check for side-effects.</p>\n<p>I&#8217;m running my tests in the browser because for the life of me I couldn&#8217;t get <a href=\"https://github.com/metaskills/mocha-phantomjs\" target=\"_blank\">mocha-phantomjs</a> to run the tests even though they seem to work fine. No output at all.</p>\n<p>Most of my tests merely check that views are rendering correctly so they look something like this:</p>\n<pre lang=\"javascript\">describe(\"Events\", function () {\r\n\r\n            beforeEach(function () {\r\n                App.state.clear({silent: true});\r\n                $(\"div#view\").html(\"\");\r\n            });\r\n\r\n            it(\"renders go button\", function () {\r\n                App.state.set({page: \"events\"});\r\n\r\n                var $go = $(\"div#view a.go:visible\");\r\n                $go.size().should.equal(1);\r\n                $go.attr(\"href\").should.equal(\"/lobby\");\r\n            });\r\n});</pre>\n<p>As you can see, my testing harness has a <em>div#view </em>where things render, then I tell the App to go into a certain state and check the correct view has rendered.</p>\n<p>This is where things get tricky and I have yet to fully figure them out.</p>\n<p>I want to test the actions the App takes. Does clicking a button perform the right actions? Does it react correctly to changes in the url? Stuff like that.</p>\n<p>Problem is, triggering those actions would make the browser navigate away from the <a class=\"zem_slink\" title=\"Testbed\" href=\"http://en.wikipedia.org/wiki/Testbed\" rel=\"wikipedia\" target=\"_blank\">test bed</a> and that&#8217;s not what I want. There&#8217;s already enough issues with the App reacting to some events by pushing url changes to the browser so I can&#8217;t just blindly refresh the test page.</p>\n<p>Another interesting source of problems is that in some states the App must perform a redirect &#8211; sometimes you want to run the tests, but are greeted with a <em>&#8220;Oh hey, let me just redirect that to X!&#8221;</em></p>\n<p>I hear Casper.js is a better fit for making full navigation tests, so that&#8217;s the next thing I&#8217;ll be looking into.</p>\n<p>Despite the failings of my approach, frontend testing has already been a great help with this project. No longer must I spend five minutes clicking around to see changes in a view that&#8217;s 5 steps down the funnel, I have a reasonable first indicator of problems when dependencies bleed over &#8230;</p>\n<p>&#8230; hell, it&#8217;s even caught a backend bug that I didn&#8217;t anticipate in the other <a class=\"zem_slink\" title=\"Test suite\" href=\"http://en.wikipedia.org/wiki/Test_suite\" rel=\"wikipedia\" target=\"_blank\">test suite</a>. Scoar!</p>\n<p>Most of all, it makes development more pleasurable. Seeing those views fly by when the tests run brings a smile to my face in pure nerdy joy.</p>\n<p>That&#8217;s important.</p>\n<h6 class=\"zemanta-related-title\" style=\"font-size: 1em;\">Related articles</h6>\n<ul class=\"zemanta-article-ul zemanta-article-ul-image\" style=\"margin: 0; padding: 0; overflow: hidden;\">\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://swizec.com/blog/testing-socket-io-apps/swizec/5625\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/129148469_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://swizec.com/blog/testing-socket-io-apps/swizec/5625\" target=\"_blank\">Testing socket.io apps</a></li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://dailyjs.com/2012/12/06/backbone-tutorial-2/\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/noimg_68_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://dailyjs.com/2012/12/06/backbone-tutorial-2/\" target=\"_blank\">Backbone.js Tutorial: Google&#8217;s APIs and RequireJS</a></li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://blog.shinetech.com/2012/12/24/an-identity-map-for-backbone-js/\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/134104481_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://blog.shinetech.com/2012/12/24/an-identity-map-for-backbone-js/\" target=\"_blank\">An Identity Map for Backbone.js | The Shine Technologies Blog</a></li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://japhr.blogspot.com/2012/12/more-mock-http-requests-in-dart.html\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/134197046_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://japhr.blogspot.com/2012/12/more-mock-http-requests-in-dart.html\" target=\"_blank\">More Mock Http Requests in Dart</a></li>\n<li class=\"zemanta-article-ul-li-image zemanta-article-ul-li\" style=\"padding: 0; background: none; list-style: none; display: block; float: left; vertical-align: top; text-align: left; width: 84px; font-size: 11px; margin: 2px 10px 10px 2px;\"><a style=\"box-shadow: 0px 0px 4px #999; padding: 2px; display: block; border-radius: 2px; text-decoration: none;\" href=\"http://www.joezimjs.com/javascript/tips-for-front-end-unit-testing/\" target=\"_blank\"><img style=\"padding: 0; margin: 0; border: 0; display: block; width: 80px; max-width: 100%;\" src=\"http://i.zemanta.com/134107575_80_80.jpg\" alt=\"\" /></a><a style=\"display: block; overflow: hidden; text-decoration: none; line-height: 12pt; height: 80px; padding: 5px 2px 0 2px;\" href=\"http://www.joezimjs.com/javascript/tips-for-front-end-unit-testing/\" target=\"_blank\">Tips for Front End Unit Testing</a></li>\n</ul>\n<div class=\"zemanta-pixie\" style=\"margin-top: 10px; height: 15px;\"><a class=\"zemanta-pixie-a\" title=\"Enhanced by Zemanta\" href=\"http://www.zemanta.com/?px\"><img class=\"zemanta-pixie-img\" style=\"border: none; float: right;\" src=\"http://img.zemanta.com/zemified_e.png?x-id=066807a4-33f4-4024-b1d1-c7cb923d86af\" alt=\"Enhanced by Zemanta\" /></a></div>\n"},"site":{"siteMetadata":{"title":"Swizec Blog","subtitle":"Fetch Data From Local WP Install"}}},"pageContext":{"id":"6edafc28-22ea-5553-b4ea-695a915cc43d"}}