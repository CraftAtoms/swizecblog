{"data":{"wordpressPost":{"title":"A day is not 60*60*24 seconds long","content":"<p>I was fixing some code written by an intrepid junior the other day and came upon this beauty:</p>\n<pre lang=\"javascript\">var day = 1000*60*60*24;\nvar week = day*7;\n\nvar yesterday = new Date(today.getTime() - day);\nvar lastWeek = new Date(today.getTime() - week);\n</pre>\n<p>Looks pretty good, right? It calculates the timestamp for yesterday and a timestamp for last week by deducting the amount of milliseconds in a day and a week from the current time. Clever.</p>\n<p>But wait ‚Ä¶ Does it smell bad to you? I&#8217;ll give you a minute.</p>\n<p>&#8230;</p>\n<p>How about now? Are your nose hairs sizzling yet?</p>\n<p>Maybe not. I mean, we&#8217;ve all written code like this. Maybe not recently, but for sure when we were starting out. Even the internet didn&#8217;t smell anything.</p>\n<blockquote class=\"twitter-tweet\" lang=\"en\">\n<p dir=\"ltr\" lang=\"en\">Pop quiz: Why is this code wrong?&amp;#10;&amp;#10;var day = 1000*60*60*24</p>\n<p>&amp;mdash; Swizec (@Swizec) <a href=\"https://twitter.com/Swizec/status/661675783199453184\">November 3, 2015</a></p></blockquote>\n<p>There‚Äôs less context, but the smelliest line of code is still there.</p>\n<p>Answers ranged from the slightly missing the point:</p>\n<blockquote class=\"twitter-tweet\" data-conversation=\"none\" lang=\"en\">\n<p dir=\"ltr\" lang=\"en\"><a href=\"https://twitter.com/Swizec\">@Swizec</a>because there aren&amp;#39;t 60,000 seconds in a minute. context would be helpful</p>\n<p>&amp;mdash; Aron (@MrAronD) <a href=\"https://twitter.com/MrAronD/status/661677631360888832\">November 3, 2015</a></p></blockquote>\n<p>To the snarky:</p>\n<blockquote class=\"twitter-tweet\" data-conversation=\"none\" lang=\"en\">\n<p dir=\"ltr\" lang=\"en\"><a href=\"https://twitter.com/Swizec\">@swizec</a> You should use ES6&amp;#39;s const instead of var&#8230;</p>\n<p>&amp;mdash; An≈æe Peƒçar (@Smotko) <a href=\"https://twitter.com/Smotko/status/661676777534857217\">November 3, 2015</a></p></blockquote>\n<p>And even some that tried to do a linter&#8217;s job.</p>\n<p>They all have <b>a</b> point, but none of them got <b>the</b> point.</p>\n<p>Days aren&#8217;t <code>60*60*24</code> seconds long. They are <code>1 day</code> long, which on most days maps to <code>60*60*24 = 86400</code> seconds. But not on all days.</p>\n<p>Thanks to the wonder that is daylight savings time (DST), we have a day that&#8217;s only 23 hours long. We also have a day that&#8217;s 25 hours long. Then, every few years, we have a day that&#8217;s 86,401 seconds long. In theory, we could even have a day that&#8217;s 86,399 seconds long. It‚Äôs unlikely, but it‚Äôs possible.</p>\n<p>But, I mean, who cares, right? It&#8217;s just an hour here, an hour there, and maybe a second when no one‚Äôs paying attention. Nobody&#8217;s going to notice. <i>24 hours ago</i> should still mean <i>yesterday</i>.</p>\n<p>Here&#8217;s the thing, though. Just because it‚Äôs <i>yesterday</i> doesn‚Äôt mean it‚Äôs also <i>1 day ago</i>.</p>\n<p>Let‚Äôs say this code runs between 2 am and 3 am on the days when daylight savings time goes away. First of all, not all countries do the change; not even all US states do. Second of all, there are <b>two</b> instances of <i>the hour between 2 am and 3 am</i>.</p>\n<p>Let me show you some examples:</p>\n<pre lang=\"javascript\">new Date((new Date(\"<a href=\"tel:2015110102\">2015-11-01 02</a>:59 pst\").getTime()-1000*60*60*24))\n// Sat Oct 31 2015 03:59:00 GMT-0700 (PDT)\nnew Date((new Date(\"<a href=\"tel:2015110102\">2015-11-01 02</a>:59 pdt\").getTime()-1000*60*60*24))\n// Sat Oct 31 2015 02:59:00 GMT-0700 (PDT)\n</pre>\n<p>Subtracting 24 hours from PST (Pacific Standard Time) gives you the day before, but an hour later. Subtracting 24 hours from PDT (Pacific Daylight Time) gives you the day before at the same time. This timezone name-change is how you know which side of DST you&#8217;re on.</p>\n<p>The same example without specifying a timezone chooses your local timezone (which for me is PST):</p>\n<pre lang=\"javascript\">new Date((new Date(\"2015-11-01 02:59\").getTime()-1000*60*60*24))\n// Sat Oct 31 2015 03:59:00 GMT-0700 (PDT)\n</pre>\n<p>Now let&#8217;s see what happens in March, when daylight savings time goes back into effect:</p>\n<pre lang=\"javascript\">new Date((new Date(\"2015-03-08 02:30 pdt\").getTime()-1000*60*60*24))\n// Sat Mar 07 2015 01:30:00 GMT-0800 (PST)\nnew Date((new Date(\"2015-03-08 02:30 pst\").getTime()-1000*60*60*24))\n// Sat Mar 07 2015 02:30:00 GMT-0800 (PST)\n</pre>\n<p>We didn&#8217;t get the wrong date because JavaScript is awesome and automatically covers up the mess with timezone changes. It knows that on these key days, PST becomes PDT and vice-versa.</p>\n<p>At least, this is what happened when I ran the code in San Francisco. When I tried in Denver, a few days later, it looked like this:</p>\n<pre lang=\"javascript\">new Date((new Date(\"2015-11-01 02:59 pst\").getTime()-1000*60*60*24))\n// Sat Oct 31 2015 04:59:00 GMT-0600 (MDT)\nnew Date((new Date(\"2015-11-01 02:59 pdt\").getTime()-1000*60*60*24))\n// Sat Oct 31 2015 03:59:00 GMT-0600 (MDT)\nnew Date((new Date(\"2015-11-01 01:59 pdt\").getTime()-1000*60*60*24))\n// Sat Oct 31 2015 02:59:00 GMT-0600 (MDT)\nnew Date((new Date(\"2015-11-01 01:59 pst\").getTime()-1000*60*60*24))\n// Sat Oct 31 2015 03:59:00 GMT-0600 (MDT)\n</pre>\n<p>Notice the funny part? At 2:59, we‚Äôre hit by San Francisco‚Äôs DST change. At 1:59, we‚Äôre hit with Denver‚Äôs DST change. That‚Äôs because Denver is on Mountain Time, which is an hour ahead of Pacific Time. So Denver goes through the DST change an hour before San Francisco does. Mind = blown.</p>\n<p>Now, this wasn‚Äôt too bad because JavaScript is amazing and knows when to automatically switch timezones. But what if you‚Äôre in Arizona? That state‚Äôs on Mouintain Time, and <i>most of it</i> doesn‚Äôt observe daylight savings. Now JavaScript needs to know a whole lot about your user. Let‚Äôs hope it does.</p>\n<p>You might not care about any of this, but if your job is to capture <i>all of X from yesterday</i>, then you&#8217;re in for a ride when your boss or client says, &#8220;Errrr, there seems to be a whole hour of events missing. That&#8217;s 10,000 datapoints. Where did they go?&#8221;</p>\n<p>Then there are leap seconds.</p>\n<p>In a way, leap seconds are less of a problem because you can only get it wrong by a second; but, when you&#8217;re calculating with Unix epoch times (which is what <code>getTime()</code> does, by the way), you don&#8217;t have the luxury of timezones. Not that timezones would help for leap seconds.</p>\n<p>You&#8217;d think a system that counts seconds since January 1st, 1970, wouldn&#8217;t have this problem. Unfortunately, you‚Äôd be wrong.</p>\n<blockquote><p>Observe that when a positive leap second occurs (i.e., when a leap second is inserted), the Unix time numbers repeat themselves. The Unix time number 915148800.50 is ambiguous. It can refer either to the instant in the middle of the leap second, or to the instant one second later, half a second after midnight UTC.</p>\n<p>&amp;embdash; Wikipedia (<a href=\"https://en.wikipedia.org/wiki/Unix_time\">https://en.wikipedia.org/wiki/Unix_time</a>)</p></blockquote>\n<p>Let&#8217;s see what JavaScript will do in this situation:</p>\n<pre lang=\"javascript\">new Date(new Date(\"1999-01-01T00:00:00.00\").getTime()-1000*60*60*24)\n// Wed Dec 30 1998 16:00:00 GMT-0800 (PST)\n</pre>\n<p>Ok. That‚Äôs bad. We&#8217;ve lost an entire day. I‚Äôm pretty sure that‚Äôs going to be a problem. If your boss or client was unhappy about the 10,000 datapoints you missed when you got it wrong by an hour, how will they feel about losing 240,000 datapoints?</p>\n<p>Oh, and by the way, stop using Unix timestamps as unique identifiers because they‚Äôre not unique.</p>\n<p>All that said, there were two or three people that put garlic around their necks, tossed salt over their shoulders, and ran as fast as their legs would carry them.</p>\n<blockquote class=\"twitter-tweet\" data-conversation=\"none\" lang=\"en\">\n<p dir=\"ltr\" lang=\"en\"><a href=\"https://twitter.com/Swizec\">@Swizec</a> because it doesn&amp;#39;t account for leap seconds? something to do with floating point rounding since that appears to be javascript? idk</p>\n<p>&amp;mdash; Aron (@MrAronD) <a href=\"https://twitter.com/MrAronD/status/661676799022276608\">November 3, 2015</a></p></blockquote>\n<blockquote class=\"twitter-tweet\" data-conversation=\"none\" lang=\"en\">\n<p dir=\"ltr\" lang=\"en\"><a href=\"https://twitter.com/Swizec\">@Swizec</a> This is a minefield, especially for distributed systems. See falsehoods programmers believe about time: <a href=\"https://t.co/C3CCMMhIib\">https://t.co/C3CCMMhIib</a></p>\n<p>&amp;mdash; galar (@galar) <a href=\"https://twitter.com/galar/status/661701633030647809\">November 4, 2015</a></p></blockquote>\n<p>You should read the falsehoods article. Dealing with time <i>is</i> a minefield.</p>\n<p>Oh, one more thing. Relativistic effects come into play for rocket guidance systems, things running on space stations, and anything moving quickly. That&#8217;s when a second is no longer a second.</p>\n<p>Let‚Äôs hope neither the military nor any astronauts ever use your real-time smartphone app or website.</p>\n<p>P.S.: There&#8217;s internet on the International Space Station. üòâ</p>\n"},"site":{"siteMetadata":{"title":"Swizec Blog","subtitle":"Fetch Data From Local WP Install"}}},"pageContext":{"id":"e8f974f7-5cda-5ba5-b5f1-b0eb4a0a3d23"}}